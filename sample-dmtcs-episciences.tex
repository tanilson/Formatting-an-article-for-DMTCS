\documentclass[
%%% one of
submission
%final
%proceedings
%%% if you compile a final version for the old OJS platform
% , ojs
%%% if all authors have the same affiliation
% , nomarks
]{dmtcs-episciences}

% DON'T LOAD ANY STYLES THAT CHANGE THE PAGE LAYOUT
% AND DON'T CHANGE THE PAGE LAYOUT BY HAND, EITHER.


\usepackage[utf8]{inputenc}
\usepackage{subfigure}

%\usepackage[utf8]{inputenc} %latin1
\usepackage{amsmath,amssymb}
\usepackage{url}

\usepackage[caption=false]{subfig}
\usepackage{braket}
\usepackage{amsfonts}
\usepackage{amsthm}
\usepackage{fancyhdr}
\usepackage{comment}
\usepackage{float}
\usepackage{mathtools}
\usepackage{xspace}
\usepackage[inline]{enumitem}
\usepackage[export]{adjustbox}

%\usepackage[numbers]{natbib} %para aparecer o numero e nao nome das referencias
%\bibliographystyle{IEEEtranN}
\usepackage{diagbox} %risco diagonal tabela
\DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}


\newtheorem{theorem}{Theorem}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{prop}[theorem]{Proposition}
\newtheorem{fact}[theorem]{Fact}
\renewcommand{\proofname}{Proof}

% graphicx is now loaded automatically no need to put this in here anymore.
%
%\usepackage{graphicx}

% We strongly recommend to use natbib. Your colleagues deserve to be
% named in your text. PLEASE, ADAPT YOUR TEXT ACCORDINGLY, such that
% citations are grammatically correct.
\usepackage[round]{natbib}

\author[Bornstein, Golumbic, Santos, Souza, Szwarcfiter]{Claudson F. Bornstein\affiliationmark{1} \and Martin Charles Golumbic\affiliationmark{2}\\ \and Tanilson D. Santos\affiliationmark{1,3,}\thanks{This study was financed in part by the Coordena{\c c}\~ao de Aperfei{\c c}oamento de Pessoal de N\'ivel Superior - Brasil (CAPES) - Finance Code 001.}  \and UÃ©verton S. Souza\affiliationmark{4} \and Jayme L. Szwarcfiter\affiliationmark{1,5}
}
\title[The Complexity of Helly-$B_{1}$ EPG Graph Recognition]{The Complexity of Helly-$B_{1}$ EPG Graph Recognition}
% put your affiliation here, not your full address.
% If you like to give away your email or other parts of your address,
% THIS IS NOT THE RIGHT PLACE, your address will change, this paper
% will not.
% Just watch that your personal data that you want to communicate on
% the episcience server is always up to date.
\affiliation{
  % one line per affiliation, no postal codes, grant numbers or similar
  Federal University of Rio de Janeiro - Brazil \\
  University of Haifa - Israel\\
  Federal University of Tocantins  - Brazil \\
  Fluminense Federal University - Brazil \\
  State University of Rio de Janeiro - Brazil}
  %Alma Mater, campus universalis, terra incognita}
\keywords{Edge-intersection of paths on a grid, EPG graphs, Helly property, Intersection graphs, $NP$-completeness, Single bend paths.
}
% don't try to cheat here, we will check the dates!
\received{1998-10-14}
\revised{2002-07-19, 2014-02-05, 2015-09-09}
\accepted{2015-09-09}
\begin{document}
\publicationdetails{VOL}{2015}{ISS}{NUM}{SUBM}
\maketitle
\begin{abstract}
  Golumbic, Lipshteyn and Stern defined in 2009 the class of EPG graphs, as the  intersection graph of edge paths on a grid. An EPG graph $G$ is a graph that admits a representation where its vertices correspond to paths in a grid $Q$, such that two vertices of $G$ are adjacent if and only if their corresponding paths in $Q$ have a common edge. If the paths in the representation have at most $k$ changes of direction  (bends), we say that it is a  $B_k$-EPG representation. A collection $C$ of sets satisfies the Helly property when every sub-collection of $C$ that is pairwise intersecting has at least one common element. 
In this paper we show that the problem of recognizing $B_k$-EPG graphs $G=(V,E)$ whose edge-intersections of paths in a grid satisfy the Helly property, so-called Helly-$B_k$ EPG graphs, is in $\mathcal{NP}$, for every $k$ bounded by a polynomial of $|V(G)|$. In addition, we show that recognizing Helly-$B_1$ EPG graphs is $NP$-complete, and it remains $NP$-complete even when restricted to 2-apex and 3-degenerate graphs.
\end{abstract}


\section{Introduction}
An EPG graph $G$ is a graph that admits a representation in which its vertices are represented by paths of a grid $Q$, such that two vertices of $G$ are adjacent if and only if the corresponding paths have at least one common edge. 

The study of EPG graphs has motivation related to the problem of VLSI design that combines the notion  of  edge  intersection graphs  of  paths  in  a  tree  with  a  VLSI  grid  layout  model, see~\cite{golumbic2009}. The number of bends in an integrated circuit may increase the layout area, and consequently increase the cost of chip manufacturing.
This is one of the main applications that instigate research on the EPG representations of some graph families when there are constraints on the number of bends in the paths used in the representation.
Other applications and  details  on  circuit  layout  problems can be found in~\cite{bandy1990, molitor1991}.  %, which can be represented as paths in a rectangular orthogonal grid.

%A graph is a $ B_k$-EPG graph if it admits a representation in which each path has at most $k$ bends. %As an example, Figure~\ref{fig:trianguloepgRepresentacao}(a) shows a $C_3$, Figure~\ref{fig:trianguloepgRepresentacao}(b) shows an EPG representation where the paths have no bends and Figure~\ref{fig:trianguloepgRepresentacao}(c) shows a representation with 1 bend. 
 %Consequently, $C_3$ is a $B_0$-EPG graph. More generally, $B_0$-EPG graphs coincide with interval graphs.
 
 A graph is a $ B_k$-EPG graph if it admits a representation in which each path has at most $k$ bends. As an example, Figure~\ref{fig:trianguloepgRepresentacao}(a) shows a $C_3$, Figure~\ref{fig:trianguloepgRepresentacao}(b) shows an EPG representation where the paths have no bends and Figure~\ref{fig:trianguloepgRepresentacao}(c) shows a representation with at most 1 bend per path.   
 Consequently, $C_3$ is a $B_0$-EPG graph. More generally, $B_0$-EPG graphs coincide with interval graphs.

%\input{representacoesepgtriangulo.tex}
\begin{figure}[h]
  \centering
  \begin{tabular}{ p{3cm} p{0.7cm} p{4cm} p{0.7cm} p{4cm} }
    %\centering
    \includegraphics[width=2.3cm]{trianguloabc} && \includegraphics[width=3.5cm]{b0epgTransparenciaGrade2} & &
    \includegraphics[width=3.5cm]{b1EpgTransparenteGrade2}
    \\
    \footnotesize %\centering 
    (a) The  graph $C_3$ && \footnotesize(b) $B_0$-EPG representation of $C_3$ (edge-clique)&& \footnotesize(b) (c) $B_1$-EPG representation of $C_3$ (claw-clique)\\
  \end{tabular}

 \caption{The  graph $ C_3 $  and  representations without bends and with 1 bend} \label{fig:trianguloepgRepresentacao}
\end{figure}

The \emph{bend number} of a class of graphs is the smallest $k$ for which all graphs in the class have a $B_k$-EPG representation. Interval graphs have bend number $0$~\cite{golumbic2009}, trees have bend number $1$~\cite{golumbic2009} and outerplanar graphs have bend number $2$~\cite{daniel2014b}. The bend number for the class of planar graphs is still open, but it is either $ 3 $ or $4$~\cite{daniel2014b}.


%For some classes of graphs we know the smallest value of $k$ for which the graphs in the class are $B_k$-EPG. For example,
% although no example has yet been found of a planar graph that fails to be B3-EPG

The class of EPG graphs has been studied in several papers, such as \cite{alcon2016, Asinowski2009, cohen2014, golumbic2009, heldt2014,  martin2017}, among others. The investigations frequently approach characterizations with respect to the number of bends of the graph representation. Regarding the complexity of recognizing $B_k$-EPG graphs, only the complexity of recognizing few of these sub-classes of EPG graphs have been determined: %$ B_0$-EPG, $ B_1$-EPG ~\cite{heldt2014} and more recently $B_2$-EPG ~\cite {martin2017}.  
 $B_0$-EPG graphs can be recognized in polynomial time, since it corresponds to the class of interval graphs, see ~\cite{booth1976}. In contrast, recognizing $B_1$-EPG and $B_2$-EPG graphs are $NP$-complete problems, see~\cite{heldt2014} and \cite{martin2017}, respectively. Moreover, recognizing $B_1$-EPG graphs  remains $NP$-complete even for $L$-shaped paths in grid, see~\cite{cameron2016edge}.

%\vspace{-0.5cm}
%\input{./includes/include-img/representacoesepgtriangulo.tex}


A  collection $C$ of sets satisfies the Helly property when every sub-collection of $ C $ that is pairwise intersecting has at least one common element. %The Helly property has this name in honor of the great Austrian mathematician Eduard Helly, who in 1923 proposed his famous theorem concerning the relation of intersecting sets.
The study of the Helly property is useful in very diverse areas of science, and we can enumerate applications in semantics, code theory, computational biology, database, image processing, graph theory, optimization, and linear programming \cite{dourado2009}.

%Note that the representation of Figure~\ref{fig:trianguloepgRepresentacao}(b) satisfies the Helly property, while the representations of Figures~\ref{fig:trianguloepgRepresentacao}(c) and~\ref{fig:trianguloepgRepresentacao}(d) do not satisfy it.

The Helly property can be applied to the $ B_k $-EPG representation problem, where each path is considered to be a set of edges. A graph $ G $ has a  Helly-$B_k$ EPG representation if there is a $ B_k $-EPG representation of $G$ where each path has at most $ k $ bends and this representation satisfies the Helly property. 
 Figure~\ref{fig:envelopeRepresentacoes}(a) presents two $B_1$-EPG representations of a graph with five vertices.  Figure~\ref{fig:envelopeRepresentacoes}(b)   illustrates 3 pairwise intersecting paths ($P_{v_1}, P_{v_2}, P_{v_5}$), containing a common edge, so it is a Helly-$B_1$ EPG representation. In Figure~\ref{fig:envelopeRepresentacoes}(c), although the three paths are pairwise intersecting, there is no common edge in all 3 paths, and therefore they do not satisfy the Helly property. 
The Helly property related to EPG representations of graphs has been studied in~\cite{golumbic2009} and~\cite{golumbic2013}. In particular, they have determined the strong Helly number of $B_1$-EPG graphs. 

%\input{envelope.tex}
\begin{figure}[h]
  \centering
  \begin{tabular}{ p{3.2cm} p{4.5cm} p{4.5cm} }
    \centering \includegraphics[width=3cm]{envelope} & \includegraphics[width=4cm]{envelopeHellyGradeTransparente} & \includegraphics[width=4cm]{envelopeNaoHellyGrade}
    \\
    \footnotesize \centering (a) A  graph with 5 vertices & \footnotesize(b) $B_1$-EPG representation that satisfies the Helly property & \footnotesize (c) $B_1$-EPG representation that does  not satisfy the Helly property  \\

  \end{tabular}
\caption{A  graph with 5 vertices in (a) and some single bend representations: Helly in (b) and not Helly in (c)} \label{fig:envelopeRepresentacoes}
\end{figure}

 %\subsection{Basic definitions}
 Next, we describe some terminology and notation used.

%@comment falar q a diagonal nÃ£o Ã© considerada
%ver se o conceito de direÃ§Ã£o nÃ£o confunde com caminho direcionado

The term \emph{grid} is used to denote the Euclidean space of integer orthogonal coordinates. Each pair of integer \emph{coordinates} corresponds to a point or vertex of the grid. The term \emph{edge of the grid}, will be used to denote a pair of vertices that are at distance one in the grid. Two edges $e_1$ and $e_2$ are \emph{consecutive edges} when they share exactly one point of the grid. %have a common vertex. %A \emph{finite sequence of consecutive edges} is a finite sequence where every vertices are differents  
 A (simple) path in the grid is as a sequence of distinct  edges $e_1, e_2, \leq, e_m$,  where consecutive edges are adjacent, i.e., contain a common vertex, whereas non-consecutive edges are not adjacent.  In this context, two paths only intersect if they have at least a common edge. The first and last edges of a path are called \emph{extremity edges}.
 
 %A \emph{path in the grid} is any finite sequence of distinct consecutive edges $e_1 = (v_1, v_{2}), e_2 = (v_2, v_{3}), \dots, e_i = (v_i, v_{i+1}), \dots, e_m = (v_{m}, v_{m+1})$, where $v_i \neq v_j$ for $i \neq j$. 
 
 
 
 
 
 %A path in the grid is any  sequence of distinct  consecutive edges $e_1,e_2, \leq, e_m$,  where each pair of consecutive edges contain a common vertex.  In this context, two paths only intersect if they have at least a common edge.
 
 %A \emph{path in the grid} is any finite sequence of consecutive edges $e_1 = (v_1, v_{2}), e_2 = (v_2, v_{3}), \dots, e_i = (v_i, v_{i+1}), \dots, e_m = (v_{m}, v_{m+1})$, where v_i != v_j for i != j
 
 
 
 
The \emph{direction of an edge} is vertical when the first coordinates of its vertices  are equal, and is horizontal when the second coordinates are equal. A \emph {bend} in a path is a pair of consecutive edges $ e_1, e_2 $ of that path, such that the directions of $ e_1$ and $ e_2$ are different. When two edges $ e_1$ and $e_2 $ form a bend, they are called \emph { bend edges}. A \emph {segment} is a set of consecutive edges with no bends. %is a path with no bends.
 Two paths are said to be \emph{edge-intersecting}, or  simply  \emph{intersecting}, if they share at least one edge. %Otherwise we say they are \emph{edge-disjoint} (or disjoint).
 Throughout the paper any time we say that two paths intersect, we mean that they edge-intersect.  %, all intersections of paths are meant to edge intersections.

EPG graphs are the class of intersection graphs of paths in a grid~\cite{golumbic2009}. This class,  consists of the class of graphs in which its vertices are represented by paths of a grid $ Q $, such that two vertices in $ G $ are adjacent if and only if their corresponding paths intersect. If every path in the representation has at most $ k $ bends, we say that this graph $ G $ has a \emph{ $ B_k$-EPG} representation.%, and we will indicate this representation by the notation $ B_k$-EPG($ G $).
  When $ k = 1 $ we say that this is a \emph{single bend} representation.


%Two sets, $ A $ and $ B $, are \emph{intersecting} $ A \cap B \neq \emptyset $. 
A family of sets is \emph{pairwise intersecting} if any two sets in the family intersect. A collection of non-empty sets $C$ satisfies the Helly property when every pairwise intersecting sub-collection $S$ of $ C $ has at least one element that is in every subset of $S$.

The Helly property can be applied to the $ B_k $-EPG representation problem, where each path is considered to be a set of edges. A graph $ G $ has a  Helly-$B_k$ EPG representation if there is a $ B_k $-EPG representation of $G$ where each path has at most $ k $ bends and this representation satisfies the Helly property. %Further for all subset of pairwise intersecting paths, there is an edge common to all paths of this subset, we will indicate this representation by the notation H-$B_k$-EPG($G$). 
%  Figure~\ref{fig:envelopeRepresentacoes}(a) presents two $B_1$-EPG representations of a graph with five vertices.  Figure~\ref{fig:envelopeRepresentacoes}(b)   presents 3 pairwise intersecting paths ($P_{v_1}, P_{v_2}, P_{v_5}$), containing a common edge, so it is a Helly-$B_1$ EPG representation. In Figure~\ref{fig:envelopeRepresentacoes}(c), although the three paths are pairwise intersecting, there is no common edge in all 3 paths, and therefore they do not satisfy the Helly property. 
% \vspace{-0.5cm}
% \input{./includes/include-img/envelope.tex}

%An \emph{edge (of the grid) is relevant} if at least one of its coordinates is the start, bend, or end of a path. A  \emph{maximal segment} is one whose its ends are relevant edges.  

%A $B_k$-EPG representation \emph{is normalized} when all columns $(i,i+1)$ and rows $(j,j+1)$ that have only not relevant edges in the representation have been removed. 

 %The next lemma, shows that every graph is an EPG-graph.
 %\vspace{-0.5cm}
 %It is easy to construct EPG representations to verify the following lemmas.
 
 This paper studies graphs that have a Helly-EPG representation. We prove that the problem of recognizing Helly-$B_1$ EPG graphs is $NP$-complete. In particular, we show that  this results remains true even if the graphs are $2$-apex and $3$-degenerate.


\section{Preliminaries}

The study starts with the following lemma.
 
 \begin{lemma}[\cite{golumbic2009}] \label{lem:todoGrafoEpg}
 Every graph is an EPG graph.
 \end{lemma}
%  \begin{proof}
%  Let $G=(V,E)$ be a graph with vertices $v_1,\dots ,v_n$. Consider the grid $Q$ with rows $[1,\dots ,n]$ and columns $[1, 1', 2, 2', \dots, n,n']$. 
 
%  Consider the vertex $v_i$ and denote $N^+(v_i)$= $\{v_j|i<j,(i,j)\in E\}$, where $N^+(v_i)$= $\{v_{j_1}, \dots, v_{j_k}\}$ is ordered with $\{v_{j_1}< \dots < v_{j_k}\}$.   The path $P_i$ on $Q$ is defined starting horizontally from grid point $(1,i)$ to $(i,i)$, continuing vertically to $(i,j_1)$, horizontally to $(i',j_1)$, continuing vertically to $(i,j_2)$, horizontally to $(i',j_2)$, continuing vertically $(i,j_3)$, horizontally $(i',j_3)$, etc. i.e., we alternate between column $i$ and column $i'$ as we go across on each level $j_1, j_2, \dots, j_k$. %reference Figure
%  We prove that $P_i$ on the grid $Q$ is an EPG representation of $G$. For every $i<j,(v_i,v_j)\in E(G)$ if and only if the paths $P_i$, $P_j$ contain the horizontal grid edge $((i,j), (i',j))$. Moreover, no paths share vertical grid edges. Therefore the vertices in the graph are adjacent if and only if the corresponding paths share a common grid edge.
%   \end{proof}
 
 %Moreover, the same applies to EPG-Helly graphs. 
 
 We show that the result extends to  Helly-EPG graphs.
 
 \begin{lemma}\label{lem:todoGrafoEpgHelly}
 Every graph is a Helly-EPG  graph.
 \end{lemma}
%  \setcounter{proof}{1}
%   \begin{proof}
%   Let $G$ be a graph with $n$ vertices $v_1, v_2, \dots, v_n$ and $\mu$ maximal cliques $C_1, C_2, \dots , C_{\mu }$. We construct an EPG-Helly representation of $G$, using a grid $Q$ of size $(\mu \times 2n)$. The rows correspond to the maximal cliques and are numbered $1, 2, \dots , \mu$. Each vertex $v_j$ corresponds to the pair of columns $j, j+n$. Each maximal clique $C_i$ is mapped into an edge $(i,n), (i,n+1)$. Each path $P_j$ contains all edges $(i,n), (i,n+1)$ corresponding to the maximal cliques $C_i$ containing $v_i$.
  
%   Moreover, two distinct paths $P_j,P_k$ intersect at the edges corresponding to the maximal cliques containing $v_j,v_k$.
  
%   Let $v_j \in V(G)$, consider the maximal cliques containing $v_j$ in ascending order of their indices. The path $P_j$ representing $v_j$, start at vertex $(1,j)$ of $Q$ and descends column $j$ until $(i,j)$, where $C_i$ is the first clique containing $v_j$ then $P_j$ bends at vertex $(i,j)$ and proceeds to the right, travesses edge $(i,n), (i,n+1)$ representing $C_i$. Then $P_j$ proceeds further on row $i$ until reaching vertex $(i, j+n)$, where it bends again, descending column $j+n$ until reaching vertex $(l,j), l>i$, where $C_l$ is the next maximal clique containing $v_j$ where it bends again. It proceeds in row $l$, travessing edge $(l,n),(l,n+1)$, and so on, until all edges of $Q$ corresponding to the maximal cliques containing $v_j$ have been travessed by $P_j$.   
  
% It follows that two distinct paths, $P_j$ and $P_q$, intersect exactly at the rows corresponding to the maximal cliques containing both $v_j$ and $v_q$.  
%    \end{proof}
 
%  Figure~\ref{fig:gradeDemonstracao} shows the grid $Q$ and the path $P_2$ corresponding to the vertex $v_2 \in V(G)$, contained in maximal cliques $C_2, C_4$ and $C_5$ of $G$.
 
%   \input{./includes/include-img/grade.tex}
 \begin{proof}  %\textbf{Proof} 
  Let $G$ be a graph with $n$ vertices $v_1, v_2, \dots, v_n$ and $\mu$ maximal cliques $C_1, C_2, \dots , C_{\mu }$. We construct a Helly-EPG representation of $G$, using a grid $Q$ of size $(\mu \times 2n)$. The rows correspond to the maximal cliques and are numbered $1, 2, \dots , \mu$. Each vertex $v_j$ contains segments from column $j$ to column $j+n$. Each maximal clique $C_i$ is mapped into an edge $(i,n), (i,n+1)$. Each path $P_j$ contains all edges $(i,n), (i,n+1)$ corresponding to the maximal cliques $C_i$ containing $v_j$.
  
  Moreover, two distinct paths $P_j,P_k$ intersect at the edges corresponding to the maximal cliques containing $v_j,v_k$.
  
  Let $v_j \in V(G)$, consider the maximal cliques containing $v_j$ in ascending order of their indices. The path $P_j$ representing $v_j$, starts at vertex $(1,j)$ of $Q$ and descends column $j$ until $(i,j)$, where $C_i$ is the first clique containing $v_j$, then $P_j$ bends at vertex $(i,j)$ and proceeds to the right, traversing edge $(i,n), (i,n+1)$ representing $C_i$. Then $P_j$ proceeds further on row $i$ until reaching vertex $(i, j+n)$, where it bends again, descending column $j+n$ until reaching vertex $(l,j), l>i$, where $C_l$ is the next maximal clique containing $v_j$ where it bends again. It proceeds in row $l$, traversing edge $(l,n),(l,n+1)$, and so on, until all edges of $Q$ corresponding to the maximal cliques containing $v_j$ have been traversed by $P_j$.   
  
It follows that two distinct paths, $P_j$ and $P_q$, intersect exactly at the rows corresponding to the maximal cliques containing both $v_j$ and $v_q$.  Hence the representation is Helly.
   \end{proof}
 
 Figure~\ref{fig:gradeDemonstracao} shows the grid $Q$ and the path $P_2$ corresponding to the vertex $v_2 \in V(G)$, contained in maximal cliques $C_2, C_4$ and $C_5$ of $G$.
 
  %\input{grade.tex}
  \begin{figure}[htb]	
\center%6.3
\includegraphics[width=8cm]{grade3}
\caption{Representation of the path $P_2$ corresponding to vertex $v_2$ contained in cliques $C_2, C_4$ and $C_5$}
\label{fig:gradeDemonstracao}
\end{figure}
 
 
 \begin{corollary}\label{cor:maxCliques}
 Every graph $G$ containing $\mu$ maximal cliques admits a Helly-$B_{2\mu -1}$ EPG representation. %in a grid $Q$ of dimension $(\mu \times 2n)$.
 \end{corollary}
 
%  \subsection{The Classes $B_1$-EPG and Helly-$B_1$ EPG}

% Although classes $B_1$-EPG and Helly-$B_1$ EPG do not coincide, see Lemma~\ref{lem:octaedronaohelly}, the same does not occur for classes $ B_0$-EPG and $ B_0$-EPG-Helly, as observed in Lemma~\ref{lem:b0epg}.

% \begin {lemma} \label{lem:b0epg}
% Every $ B_0$-EPG representation satisfies the Helly property.
% \end {lemma}
% \begin {proof}
% Assume by contradiction that there exists a graph $G$ that admits a $ B_0$-EPG representation that does not satisfy the Helly property. Then, this representation has a minimal collection $ P = \{p (v_1), p (v_2), \ldots, p (v_k) \} $ of mutually intersecting paths such that $$ P_{v_1} \cap p(v_2 ) \cap \cdots \cap p(v_k) = \emptyset, k \geq 3. $$
% By minimality, we know that $ \bar{P_1} = P \setminus \{p (v_1) \}$, $ \bar {P_2} = P \setminus \{P_{v_2} \} $ and $ \bar {P_3 } = P \setminus \{p (v_3) \} $ are mutually intersecting and satisfy the Helly property.
% Thus, there are the following distinct segments $ s_{\bar{P_1}}, s_{\bar {P_2}}, s_{\bar {P_3}}$ associated with the intersection of the paths in $ \bar {P_1},  \bar {P_2} $ and $ \bar {P_3} $. Since the representation has no paths with bends, then we know that the paths in $ P$ are on the same row.
% Without loss of generality, we can assume that $ s_{ \bar {P_1}}, s_{ \bar {P_2}}$ and $ s_{ \bar {P_3}}$ occur from left to right in this order.
% Since $ s_{\bar {P_3}}$ and $ s_{\bar {P_1}}$ intersect $ P_{v_2} $, and $ p (v_2) $ is in path without bend, then $ p (v_2) $ intersects $ s_{\bar {P_2}}$. Then we have a contradiction, since $ s_{\bar {P_2}} $ intersects all paths in $ P $, contradicting the hypothesis of $ P_{v_1} \cap P_{v_2} \cap \cdots \cap p(v_k) = \emptyset $.
% \end {proof}
% %%%%%%%%%

% \begin{corollary}
% The  $B_0$-EPG class coincides with the Helly-$B_0$ EPG class.
% \end{corollary}

% $B_0$-EPG graphs coincide with the interval graphs class. The problem of interval graph recognition can be solved in linear time~\cite{booth1976}. Although the problem of $ B_1$-EPG graph recognition is NP-complete \cite {heldt2014}, the Helly-$B_1$ EPG graphs form a subclass properly contained in $ B_1$-EPG. See Figure~\ref{fig:diagramaEPG}, and the complexity of its recognition was in open. 

% Lemma \ref{lem:octaedronaohelly} shows that the classes $ B_1$-EPG and Helly-$B_1$ EPG are distinct, observing the graph octahedron $ O_3 $, see Figure~\ref{fig:octaedro}(a), which presents a minimal $B_1$-EPG representation, without considering isomorphisms, as in Figure~\ref{fig:octaedro}(b) for its representation. The octahedron graph $ O_3 $ belongs to $ B_1$-EPG but does not belong to Helly-$B_1$ EPG.

% \input{./includes/include-img/diagramaEpg.tex}

 
 
 
 
% %Most of the proofs of the paper are detailed in the Appendix.
 
%\section{Basic EPG representations}

Next we examine the $B_1$-EPG representations of a few graphs that we employ in our constructions. In special, we consider EPG representations of $C_4$'s.

%By the results of \cite{golumbic2009}, in Lemma ~\ref{lem:representacaoC4}, every induced cycle of size 4 in a $ B_1$-EPG  representation  of $C_4$ has only a few possible representations.

\begin{definition} \label{defi:tortasFrame}

Let $ Q $ be a grid and let $ (a_1, b),$ $(a_2, b),$ $(a_3, b),$ $(a_4, b)$ be a 4-star as depicted in Figure~\ref{fig:piesInGrid}(a). Let $ \mathcal{P} = \{P_1, \dots , P_4\}$ be a collection of paths each containing exactly two edges of the $4$-star:

\begin{itemize}
\item A \emph{true pie} is a representation where each $P_i$ of $ \mathcal{P} $ forms a bend in $b$.

\item A \emph {false pie} is a representation where two of the paths $P_i$ do not contain bends, while the remaining two do not share an edge. 

%In false pie only 2 paths not adjacent do bend in $b$.
%\vspace{-0.5cm}
%\input{recorteGrade.tex}
\begin{figure}[htb]
  \centering
%segundo bloco de figuras
  \begin{tabular}{c c c c c }
    \includegraphics[width=3.5cm]{disposicaoTortaGrid3}    
    & &\includegraphics[width=3.5cm]{truePieGrid} 
    & &
 \includegraphics[width=3.5cm]{falsePieGrid} \\%[\abovecaptionskip]
    {\footnotesize (a) 4-star in grid}  & &  {\footnotesize (b) True pie} & & {\footnotesize (c) False pie} %\label{fig:frame}
  \end{tabular}
  \caption{$B_{1}$-EPG representation of the induced cycle of size 4 as pies with emphasis in center $b$}\label{fig:piesInGrid}
\end{figure} 

%\vspace{-0.5cm}
\end{itemize}
\end{definition}
%In both cases the point $b$ is called \emph{center}, see Figures~\ref{fig:piesInGrid}(b) and~\ref{fig:piesInGrid}(c). There are edge-intersections $ (a_1, b), (a_2, b), (a_3, b), (a_4, b)$ called \emph{central rays}, see Figure~\ref{fig:piesInGrid}.

\begin{definition} \label{defi:tortasFrame2}
 Consider a rectangle of any size with 4 corners at vertices $ (x_1, y_1);$ $(x_2, y_1);$ $(x_2, y_2);$ $(x_1, y_2) $, positioned as in  Figure~\ref{fig:frameInGrid}. A \emph{frame} is a representation containing 4 paths $\mathcal{P} =  \{ P_1, \dots, P_4\} $, each having a bend in a different corner of a rectangle, and such that the  sub-paths $ P_1 \cap P_2, P_2 \cap P_3, P_3 \cap P_4, P_4 \cap P_1 $, share at least one edge. While the sub-paths $ P_2 \cap P_4 $ and $ P_1 \cap P_3 $ do not share edges.

%\input{dispositionFrameInGrid.tex}
\begin{figure}[htb]
  \centering
%segundo bloco de figuras
  \begin{tabular}{c c c c c }
    \includegraphics[width=3.5cm]{dispositionFrameInGrid}    
    %& &\includegraphics[width=4cm]{truePieGrid.png} 
    & &
 \includegraphics[width=3.5cm]{frameInGrid} \\%[\abovecaptionskip]
    {\footnotesize (a) Points of the coordinates of bends of a frame}  
    %& &  {\footnotesize (b) True pie} 
    & & {\footnotesize (c) Paths of a frame} %\label{fig:frame}
  \end{tabular}
  \caption{$B_{1}$-EPG representation of the induced cycle of size 4 as frame}\label{fig:frameInGrid}
\end{figure} 
\end{definition}


%\input{./includes/include-img/ciclotam4.tex}


\begin{lemma}[\cite{golumbic2009}]\label{lem:representacaoC4}
Every  $C_4$ that is an induced subgraph of a graph $ G $ corresponds, in any representation, to a true pie, a false pie, or a frame.
\end{lemma}
% \begin{proof} Consider a collection of paths $ P = \ {P_1, \dots, P_4}$ of a grid $ Q $ in a $ B_1$-EPG representation of the graph $G$.

% Consider $ C_4 = (v_1, v_2, v_3, v_4) $ that is a chordless 4-cycle in $ G$. Consider $P_i$ the path in $ G $ that corresponds to $v_i $.
% Suppose $ \displaystyle \bigcap _{P_i \in P} P_i \neq \emptyset $, then clearly $ \displaystyle \bigcap _{P_i \in P} P_i = {b} $, for some point $ b $ of the grid. Since each vertex in $ C_4 $ has exactly 2 neighbors, each path $ P_i $ contains exactly two edges of the grid with end point $ b$. Thus, we obtain a star subgraph with center point $ b $ and edges $ (a_1, b), (a_2, b), (a_3, b), (a_4, b)$.
% Without loss of generality, $ P_1 $ contains the edges $ (a_1, b), (a_2, b) $ of the grid. If $ P_2 $ contains $ (a_2, b), (a_3, b) $ or $ (a_1, b), (a_4, b) $, then we get a true pie. Otherwise, $ P_2 $ contains the edges $ (a_2, b), (a_4, b) $ or $ (a_1, b), (a_3, b) $ and we obtain a false pie.

% Otherwise, $ \displaystyle \bigcaP_ {P_i \in P} P_i = \emptyset$. Suppose $ P_1 $ is a path without bend. Each of the $ P_2 $ and $ P_4 $ paths share an edge with $ P_1 $ but do not share a common edge with any other path. If $ P_2 $ and $ P_4 $ do not have a bend, then we get a interval representation of $ C_4 - v_3 $. However, it is not possible to add a $ P_3 $ path with at most of one bend. Similarly, if $ P_2 $ and $ P_4 $ have a single bend, the $ P_3 $ path can not be added either. Therefore, $ P_1 $ has a single bend.

% By symmetry, we assume that all $ P_i $ must has a single bend. Moreover, two paths can not have a bend on a common point in the grid. Thus, we obtain a rectangular subgraph with angles $ (x_1, y_1), (x_2, y_1), (x_2, y_2), (x_1, y_2) $, where $ P_1 $ bends at $ (x_1, y_1) $, $ P_2 $ bends at $ (x_2, y_1) $, $ P_3 $ bends at $ (x_2, y_2) $, and $ P_4 $ bends at $ (x_1, y_2) $, forming a frame.
%  \end{proof}

\begin{definition}
%An edge is \emph{unnecessary} if its removal keeps the intersections and not intersection of the representation. 
A $B_k$-EPG representation is \emph{minimal} 
when its set of edges  does not properly contain another $B_k$-EPG representation. 
%when all unnecessary edges are removed.
\end{definition}

The \textit{octahedral} graph is the graph containing 6 vertices and 12 edges, depicted  in Figure~\ref{fig:octaedro}(a). Next, we consider representations of the octahedral.


The next lemma follows directly from the discussion presented in~\cite{heldt2014}.

\begin{lemma}\label{lem:octaedronaohelly}
The octahedral graph $O_3$ has a unique minimal  $ B_1$-EPG representation.%, without considering isomorphisms.
\end{lemma}
% \begin{proof}
% The octahedral graph $ O_3 $ has in its constitution induced cycles of size 4 ($ C_4$'s). 
% Take an induced $ C_4 $ subgraph  of the octahedral $ O_3 $. The pairs of non-adjacent vertices of the induced $C_4$ are false twins whose neighborhoods are the remaining of vertices of the induced $C_4$. Each of the vertices outside the $C_4$ are adjacent to all vertices of the $C_4$. Thus, if in a $ B_1$-EPG representation of $C_4$, the $ C_4 $ is represented as a frame, no single bend path can simultaneously intersect the 4 paths representing the vertices of the induced $ C_4 $. Therefore, we conclude that the frame structure can not be part of a $ O_3 $ representation.

% With the same reasoning, take a $ B_1$-EPG representation of $C_4$ where the induced $ C_4 $ subgraph is represented as true pie or false pie. When adding the false twin vertices, which are neighbors of all vertices of $ C_4 $ taken from $ O_3 $, both representations converge to the structure represented in Figure~\ref{fig:octaedro}(b). 
%  \end{proof}

\begin{proof}
The octahedral graph $ O_3 $ has in its construction induced cycles of size 4 ($ C_4$'s). 
Take an induced $ C_4 $ subgraph  of the octahedral $ O_3 $. The pairs of non-adjacent vertices of the induced $C_4$ are false twins whose neighborhoods are the remaining vertices of the induced $C_4$. Each of the vertices outside the $C_4$ are adjacent to all vertices of the $C_4$. Thus, if in a $ B_1$-EPG representation of $C_4$, the $ C_4 $ is represented as a frame, no single bend path can simultaneously intersect the 4 paths representing the vertices of the induced $ C_4 $. Therefore, we conclude that the frame structure can not be part of an $ O_3 $ representation.

With the same reasoning, take a $ B_1$-EPG representation of $C_4$ where the induced $ C_4 $ subgraph is represented as true pie or false pie.  When adding the false twin vertices, which are neighbors of all vertices of $ C_4 $ taken from $ O_3 $, both representations converge to the structure represented in Figure~\ref{fig:octaedro}(b). 
 \end{proof}

 %\input{octaedro.tex}
 \begin{figure}[h]
  \centering
  
%segundo bloco de figuras
  \begin{tabular}{@{}c@{} p{1.5cm} @{}c@{} }
   \centering \includegraphics[width=2.5cm]{octaedro} & &\includegraphics[width=2.9cm]{representacaoOctaedro}  \\[\abovecaptionskip]
    \footnotesize \centering (a) The octahedral  graph $O_3$  & &  \footnotesize(b) $B_1$-EPG representation of the graph $O_3$
  \end{tabular}

 \caption{The octahedral $O_3$ graph and its  $B_1$-EPG representation}\label{fig:octaedro}
\end{figure}
 
 %\vspace{-0.5cm}

By Lemma ~\ref{lem:octaedronaohelly},  $ O_3 $ has a unique minimal $B_1$-EPG representation, up to isomorphisms, as depicted in Figure~\ref{fig:octaedro}(b). The paths $ P_{a}, P_{b} $ and $ P_{c} $  do not satisfy the Helly property. Therefore $O_3 \notin$ Helly-$B_1$ EPG. 

Clearly, $B_0$-EPG and Helly-$B_0$ EPG graphs coincide. Hence Helly-$B_0$ EPG can be recognized in polynomial time \cite{booth1976}. However, Lemma~\ref{lem:octaedronaohelly} has proved that the class of Helly-$B_1$ EPG is a proper subclass of $B_1$-EPG. It remains the question about the complexity of recognizing Helly-$B_1$ EPG graphs. In this paper we answer such a question.

Figure~\ref{fig:diagramaEPG} depicts graphs of the classes $B_0$-EPG,  Helly-$B_1$ EPG and $B_1$-EPG that distinguish these classes.

%\input{diagramaEpg.tex}
\begin{figure}[H]	
\center%6.3
\includegraphics[width=3.5cm]{diagramaClassesEPG1} %2
\caption{Hierarchical diagram of some EPG classes}
\label{fig:diagramaEPG}
\end{figure}

\section{Membership in $\mathcal{NP}$} 

{\sc Helly-$B_k$ EPG recognition} problem can be formally described as follows:
%\input{reconhecimentob1epghelly.tex}
\begin{table}[h!]
\centering
%\caption{My caption}
%\label{my-label}
\begin{tabular}{ll}
\hline \hline
\multicolumn{2}{c}{\sc Helly-$B_k$ EPG Recognition}                         \\ \hline \hline 
\emph{Input}: & A graph $G$ and an integer $k \leq |V(G)|^c$, for some fixed $c$.\\
~ & ~ \\
\emph{Goal:}  & \begin{tabular}[c]{@{}p{9.5cm}}
Determine if there is a set of $k$-bend paths \\ $\mathcal{P} = \{P_1, P_2, \ldots, P_n\} $ in a grid $ Q $ 
such that:\\ 
$\bullet$ \ \ \ $u,v\in V(G)$ are adjacent in $G$ if only if $P_u,P_v$\\ \hspace{0.6cm} share an edge in $Q$; and\\
$\bullet$ \ \ \ $\mathcal{P}$ satisfies the Helly property.
\end{tabular} \\ \hline
\end{tabular}
\end{table}


%Let $(G,k)$ be an instance of {\sc Helly-$B_k$ EPG recognition}, and
%let $\mu$ be the number of maximal cliques of $G$. By Corollary~\ref{cor:maxCliques}, $G$ admits a $B_{2\mu -1}$-EPG-Helly representation. Therefore, since $\mu \leq 2^{|V(G)|}$, it follows that if $k\geq 2^{|V(G)|+1}-1$ then $G$ is a trivial $yes$-instance of {\sc Helly-$B_k$ EPG recognition}. Thus, without loss of generality, we can assume that $k< 2^{n+1}-1$. 

%In this paper we are interested in characterizing the complexity of the Helly-$B_1$ EPG recognition problem, whose formal definition is presented next:
In this section, we show that {\sc Helly-$B_k$ EPG Recognition}, where $k$ is bounded by a polynomial function of $|V(G)|$, belongs to $\mathcal{NP}$. 

A (positive) certificate for the {\sc Helly-$B_k$ EPG recognition} consists of a grid $Q$, a set $\mathcal{P}$ of $k$-bend paths of $Q$, which is in one-to-one correspondence with the vertex set $V(G)$ of $G$, such that, for each pair of distinct paths $P_i, P_j\in \mathcal{P}, P_i\cap P_j \neq \emptyset $ if and only if the corresponding vertices are adjacent in $G$. Furthermore, $\mathcal{P}$ satisfies the Helly property.


%The following concepts are central to our purposes. A \emph{relevant edge} in a  $B_k$-EPG representation is one which is either an extremity edge or a bend edge. Therefore each path with at the most $k$ bends can have $2(k+1)$ relevant edges, and any $B_k$-EPG representation contains at most $2|\mathcal{P}|(k+1)$ relevant edges.

%The input for the verification algorithm of the certificate is a $B_k$-EPG representation $R$ containing a collection $\mathcal{P}$ of paths, $|\mathcal{P}|=|V(G)|$, where each path $P_i \in \mathcal{P}$ is given by its set of relevant edges plus the set of relevant edges of the paths that intersect $P_i$, the relevant edges are given in the order that they appear in the path. This encoding for the paths allows us to verify if each set of relevant edges really represents a path and the paths intersections correspond to the edges of the graph in polynomial time.

The following are key concepts that make it easier to control the size of an EPG representation. A relevant edge of a path in a $B_k$-EPG representation is one which is either an extremity edge or a bend edge of the path. Therefore each path with at most $k$ bends can have up to $2(k + 1)$ relevant edges, and any $B_k$-EPG representation contains at most $2|\mathcal{P}|(k + 1)$ distinct relevant edges. 

To show that there is a non-deterministic polynomial-time algorithm for {\sc Helly-$B_k$ EPG recognition}, it is enough to consider as certificate a  $B_k$-EPG representation $R$ containing a collection $\mathcal{P}$ of paths, $|\mathcal{P}| = |V(G)|$, such that  each path $P_i \in \mathcal{P}$ is given by its set of relevant edges along with the relevant edges, that intersects $P_i$, of each path $P_j$ intersecting $P_i$, where $P_j \in \mathcal{P}$.  The relevant edges for each path are given in the order that they appear in the path, so as to make straightforward checking that the edges correspond to a unique path with at most $k$ bends.  This representation is also handy for checking that the paths form an intersection model for $G$.

In order to verify in polynomial time that the input is in fact a positive certificate for the problem, we have to assert the following:

\begin{enumerate}[label=(\roman*)]
\item The sequence of relevant edges of a path $P_i\in \mathcal{P}$ determines $P_i$ in polynomial time; \label{it:bullet1}

\item Two paths $P_i, P_j \in \mathcal{P}$ intersect if and only if they intersect in some relevant edge; \label{it:bullet2}

\item The set $\mathcal{P}$ of relevant edges satisfies the Helly property.  \label{it:bullet3}
\end{enumerate}


%The following lemma shows condition~\ref{it:bullet1} holds.

The following lemma states that condition~\ref{it:bullet1} holds. 



\begin{lemma}\label{lem:verify1}
%Each path $P_i$ can be determined in polynomial time, from the considered sequence of edges.
Each path $P_i$ can be determined uniquely in polynomial time by the sequence of its relevant edges.
\end{lemma}

% \begin{proof}
% It is easy to verify that~\ref{it:bullet1} is true, consider the sequence of relevant edges of some path $P_i\in \mathcal{P}$. Start from an extremity edge of $P_i$. Let $t$ be the line (column) containing the last considered relevant edge. The next relevant edge $e'$ in the sequence, must be also contained in line (column) $t$. If $e'$ is an extremity edge, the process is finished and the path has been determined. It contains all edges between the considered relevant edges in the sequence. Otherwise, if $e'$ is a bend edge , the next relevant edge is the second bend edge $e''$ of this same bend, which is contained in some column (line) $t'$. The process continues until the second extremity edge of $P_i$ is located.   

% With the above procedure, we can determine in $O(k+|V(G)|)$ time, whether path $P_i$ contains any given edge of the grid $Q$. Therefore, the sequence of relevant edges of $P_i$ uniquely determines $P_i$.
%  \end{proof}

\begin{proof}
%It is easy to verify that~\ref{it:bullet1} is true, 
Consider the sequence of relevant edges of some path $P_i\in \mathcal{P}$. Start from an extremity edge of $P_i$. Let $t$ be the row (column) containing the last considered relevant edge. The next relevant edge $e'$ in the sequence, must be also contained in row (column) $t$. If $e'$ is an extremity edge, the process is finished and the path has been determined. It contains all edges between the considered relevant edges in the sequence. Otherwise, if $e'$ is a bend edge , the next relevant edge is the second bend edge $e''$ of this same bend, which is contained in some column (row) $t'$. The process continues until the second extremity edge of $P_i$ is located.   

With the above procedure, we can determine in $\mathcal{O}(k\cdot |V(G)|)$ time, whether path $P_i$ contains any given edge of the grid $Q$. Therefore, the sequence of relevant edges of $P_i$ uniquely determines $P_i$.
 \end{proof}



%The lemma below shows that~\ref{it:bullet2} holds.
Next we assert property~\ref{it:bullet2}.

\begin{lemma}\label{lem:relevantEdges}
%Let $R$ be a $B_k$-EPG representation of $G$, and $P_1, P_2 \in \mathcal{P}$ paths of $R$. Then $P_1, P_2$ are intersecting paths if and only if they contain a common relevant edge.
Let $\mathcal{P}$ be the set of paths in a $B_k$-EPG representation of $G$, and let $P_1, P_2\in \mathcal{P}$. Then $P_1$, $P_2$ are intersecting paths if and only if their intersection contains at least one relevant edge.
\end{lemma}

% \begin{proof}
% If $P_1, P_2$ contain a common relevant edge there is nothing to prove. Otherwise, assume that $P_1, P_2$ are intersecting and we show they contain a common relevant edge. Without loss of generality, suppose $P_1, P_2$ intersect at line \textit{i} of the grid, in the  $B_k$-EPG representation $R$. The following are the possible cases that may occur:

% \begin{itemize}
% \item \textbf{Case 1:} Neither $P_1$ nor $P_2$ contain bends in line \textit{i}. 

% Then $P_1$ and $ P_2$  are entirely contained in line \textit{i}. Since they intersect, either $P_1, P_2$  overlap, or one of the paths contains the other. In any these situations, they intersect in a common extremity edge, that is a relevant edge.

% \item \textbf{Case 2:} $P_1$ does not contain bends in \textit{i}, but $ P_2$ does contain.

% If some bend edge of $P_2$ also belongs to $P_1$, then $P_1, P_2$  intersect in  a relevant edge. Otherwise, since $P_1, P_2$  intersect, the only possibility is that the intersection contains an extremity edge of $P_1$ or $ P_2$. Hence the paths intersect in relevant edge.  

% \item \textbf{Case 3:} Both $P_1$,  $P_2$ contain bends in \textit{i}

% Again, if the intersection occurs in some bend edge of $P_1$  or $P_2$, the lemma follows. Otherwise, the same situation as above must occur, that is $P_1, P_2$  must intersect in same extremity edge.
 
% \end{itemize}
% In any of the cases, $P_1$ and $P_2$ intersect in some relevant edge.
%  \end{proof}

\begin{proof}
 %If $P_1, P_2$ contain a common relevant edge there is nothing to prove. Otherwise,
 Assume that $P_1, P_2$ are intersecting and we show they contain a common relevant edge. Without loss of generality, suppose $P_1, P_2$ intersect at row \textit{i} of the grid, in the  $B_k$-EPG representation $R$. The following are the possible cases that may occur:

\begin{itemize}
\item \textbf{Case 1:} Neither $P_1$ nor $P_2$ contain bends in row \textit{i}. 

Then $P_1$ and $ P_2$  are entirely contained in row \textit{i}. Since they intersect, either $P_1, P_2$  overlap, or one of the paths contains the other. In any these situations, they intersect in a common extremity edge, that is a relevant edge.

\item \textbf{Case 2:} $P_1$ does not contain bends in \textit{i}, but $ P_2$ does.

If some bend edge of $P_2$ also belongs to $P_1$, then $P_1, P_2$  intersect in  a relevant edge. Otherwise, since $P_1, P_2$  intersect, the only possibility is that the intersection contains an extremity edge of $P_1$ or $ P_2$. Hence the paths intersect in relevant edge.  

\item \textbf{Case 3:} Both $P_1$,  $P_2$ contain bends in \textit{i}

Again, if the intersection occurs in some bend edge of $P_1$  or $P_2$, the lemma follows. Otherwise, the same situation as above must occur, that is $P_1, P_2$  must intersect in same extremity edge.
 
\end{itemize}
In any of the cases, $P_1$ and $P_2$ intersect in some relevant edge.
 \end{proof}



The two previous lemmas let us check that a certificate is an actual $B_k$-EPG representation of a given graph $G$.  The next lemma says we can also verify in polynomial time that the representation encoded in the certificate is a Helly representation. Fortunately we do not need to check every subset of intersecting paths  of the representation to make sure they have a common intersection. 

% \begin{enumerate}[label=\roman*]
% \setcounter{enumi}{2}
% \item The set $\mathcal{P}$ of relevant edges satisfies the Helly property. The following lemma shows the above condition.
% \end{enumerate}

\begin{lemma}\label{lem:verify3}
%Let $\mathcal{P}$ be the set of relevant edges of a $B_k$-EPG representation $R$ of a graph $G$. We can verify that $R$ is Helly representation in polynomial time.
Let $\mathcal{P}$ be a collection of paths encoded as a sequence of relevant edges that constitute a  $B_k$-EPG representation of a graph $G$. We can verify in polynomial time if $\mathcal{P}$ has the Helly property.
\end{lemma}
%\setcounter{proof}{2}

\begin{proof}
%Let $\mathcal{T}$ be the set of relevant edges of $R$. We consider each triple $T_i$ of edges of $\mathcal{T}$. Let $\mathcal{P}_i$ be the set of paths of $R$ containing at least two the relevant edges of $T_i$. By Gilmore's Theorem~\cite{bergeDuchet1975} the paths of $\mathcal{P}_i$  contain a common edge if only if  $R$ is a Helly representation.  By Lemma~\ref{lem:relevantEdges} they contain a common relevant edge. Since there is a polynomial number of relevant edges, we can identify such a common edge, in polynomial time, and confirm that $R$ is in fact Helly. Since the number of triples is also polynomial, the lemma follows.
Let $T$ be the set of relevant edges of $\mathcal{P}$. Consider each triple $T_i$ of edges of $T$ . Let $P_i$ be the set of paths of $\mathcal{P}$ containing at least two of the edges in the triple  $T_i$. By Gilmore's Theorem \cite{bergeDuchet1975}, $\mathcal{P}$ has the Helly property if an only if the subset of paths $P_i$  corresponding to each triple  $T_i$  has a non-empty intersection.  By Lemma~\ref{lem:relevantEdges}, it suffices to examine the intersections on relevant edges. Therefore a polynomial algorithm for checking if $\mathcal{P}$ has the Helly property could examine each of the subsets $P_i$, and for each relevant edge $e$ of a path in $P_i$, to compute the number of paths in $P_i$ that contain $e$. Then  $\mathcal{P}$ has the Helly property if and only if for every  $P_i$  there exists some relevant edge that is present in all paths in $P_i$,  yielding a non-empty intersection.
 \end{proof}


\begin{corollary}\label{cor:comumAtodos}
Let ${\mathcal P'}$ be a set a pairwise intersecting paths in a Helly-$B_k$ EPG representation of a graph $G$. Then the intersection of all paths of  ${\mathcal P'}$ contains at least one relevant edge.
\end{corollary}

Note that the property described in Corollary~\ref{cor:comumAtodos} is a consequence of Gilmore's Theorem, see~\cite{bergeDuchet1975}, and it applies only to representations that satisfy Helly's property.

\medskip

%The next theorem follows immediately from (i), (ii) and (iii).

%\begin{theorem} \label{teo:nppertinencia}
%A $B_k$-EPG representation of $G$ can be verified in polynomial time, for $k = \mathcal{O}(|V (G)|^c)$ for any constant  $c$.
%A $B_k$-EPG representation of $G$ can be verified in polynomial time, for $k\leq |V(G)|^c$, for some fixed integer c.
%\end{theorem}


\begin{lemma}\label{lem:gridPolinomial}
Let $G$ be a Helly-$B_k$ EPG graph. Then $G$ admits a Helly-$B_k$ EPG representation on a grid of size at most $4n(k+1) \times 4n(k+1)$.
\end{lemma}
\begin{proof}
Let $R$ be a $B_k$-EPG representation of a graph $G$ on a grid $Q$ with the smallest possible size.
Let $\mathcal{P}$ be the set of paths of $R$. Note that $|\mathcal{P}|=n$.
A counting argument shows that there are at most $2|\mathcal{P}|(k+1)$ relevant edges in $R$. 
 If $Q$ has a pair of consecutive columns $c_i,c_{i+1}$ neither of which contains relevant edges of $R$, and such that there is no relevant edge crossing from $c_i$ to $c_{i+1}$, then we can contract each edge crossing from $c_i$ to $c_{i+1}$ into single vertices so as to obtain a new  $B_k$-EPG representation of $G$ on a smaller grid, which is a contradiction. An analogous argument can be applied to pairs of consecutive rows of the grid.
 Therefore the grid $Q$ is such that each pair of consecutive columns and of consecutive rows of $Q$  has at least one relevant edge of $R$ or contains a relevant edge crossing it.  
  Since $Q$ is the smallest possible grid for representing $G$ then the first row and the first column of $Q$ must both contain at least one point belonging to some relevant edge of $R$. 
Thus, if $G$ is $B_k$-EPG then it admits a $B_k$-EPG representation on a grid of size at most $4|\mathcal{P}|(k+1) \times 4|\mathcal{P}|(k+1)$.
In addition, by Corollary~\ref{cor:comumAtodos}, it holds that the contraction operation previously described preserves the Helly property, if any. Hence, letting $R$ be a Helly-$B_k$ EPG representation of a graph $G$ on a grid $Q$ with the smallest possible size it holds that $Q$ has size at most $4|\mathcal{P}|(k+1) \times 4|\mathcal{P}|(k+1)$.
\end{proof}

\begin{theorem}\label{teo:nppertinencia}
{\sc Helly-$B_k$ EPG recognition} is in $\mathcal{NP}$, whenever $k$ is bounded by a polynomial function of $|V(G)|$.
\end{theorem}
\begin{proof}
By Lemma~\ref{lem:gridPolinomial} and the fact that $k$ is bounded by a polynomial function of $|V(G)|$, it follows that the collection $\mathcal{P}$ can be encoded through its relevant edges with $n^{\mathcal{O}(1)}$ bits.

Finally, by Lemmata~\ref{lem:verify1}, \ref{lem:relevantEdges} and \ref{lem:verify3}, it follows that one can verify in polynomial-time on the size of $G$ whether $\mathcal{P}$ is a family of paths encoded as a sequence of relevant edges that constitute a Helly-$B_k$ EPG representation of a graph $G$.
\end{proof}

\section{$NP$-hardness}\label{sec:sectionDispositivoClausula}

Now we will prove that  Helly-$B_1$ EPG graph recognition is $NP$-complete. For this proof we follow the basic strategy described in the prior hardness proof of~\cite{heldt2014}. We set up a reduction from {\sc Positive (1 in 3)-3SAT} defined  as follows:

% Now we will prove that  Helly-$B_1$ EPG graph recognition is $NP$-complete. For this proof we set up a reduction from {\sc Positive (1 in 3)-3SAT} defined  as follows:



%\input{1em33sat.tex}
\begin{table}[h!]
\centering
%\caption{My caption}
%\label{my-label}
\begin{tabular}{ll}
\hline \hline
\multicolumn{2}{c}{\sc Positive (1 in 3)-3SAT}                                \\ \hline \hline 
\emph{Input}: & \begin{tabular}[c]{@{}l@{}} A set $X$ of positive variables; a collection $C$ of clauses on $X$ such that \\ for each $c\in C$, $|c|= 3$.
\end{tabular} \\
%~ & ~ \\
\emph{Goal:}  & \begin{tabular}[c]{@{}l@{}} 
Determine if there is an assignment of values to the variables \\in $ X $ so that every clause in $ C $ has exactly one true literal.
\end{tabular} \\ \hline
\end{tabular}
\end{table}

{\sc Positive (1 in 3)-3SAT } is a well known $NP$-complete problem (see \cite{johnson1979}, problem [L04], page 259). {\sc Positive (1 in 3)-3SAT} remains $NP$-complete when the incidence graph of the input CNF (Conjunctive Normal Form) formula is a planar graph~\cite{mulzer2008minimum}.

Given a formula $F$ that is an instance of {\sc Positive (1 in 3)-3SAT} we will present a polynomial-time construction of a graph $ G_F$ such that $ G_F $ is Helly-$B_1$ EPG if and only if $ F $ is satisfiable. This graph will contain an induced subgraph $ G_{C_i}$ with 12 vertices (called \emph {clause gadget}) for every clause $C_i \in \mathcal{C}$, and an induced subgraph (\emph {variable gadget}) for each variable $ x_j$, containing a special vertex  $ v_j$, plus a \emph{base gadget}  with 55 additional vertices.

%Since a Sun graph $S_4$ whose center is a cycle of size 4 and adding a false twin to each vertex of $S_4$ that is not a member of central induced cycle then we have the graph $H$. 
We will use a graph $H$ isomorphic to the graph presented in Figure~\ref{fig:gadgetBase}, as a gadget to perform the proof. For each clause $C_i$ of $F$ of the target problem, we will have a \emph{clause gadget} isomorphic to $H$, denoted by $G_{c_i}$. %The graph $H$ consists of subgraphs whose $B_1$-EPG representations are well known, such as: cycles of sizes 3 and 4.
%\vspace{-0.5cm}

%\input{gadgetB1EpgHelly.tex} %\vspace{-0.5cm}
\begin{figure}[htb]	
\center%6.3
\includegraphics[width=4.5cm]{gadgetBase}
\caption{The partial gadget graph $H$}
\label{fig:gadgetBase}
\end{figure}



%\subsection{Definition}\label{sec:reducao}%The problem reduction}

The reduction of a formula $F$ from  {\sc Positive (1 in 3)-3SAT}  to a particular graph $G_F$ such that $G_F$ has a Helly-$B_1$ EPG representation if only if $F$ is satisfiable, is given below.

\begin{definition}\label{sec:reducao}
Let $F$ be a CNF-formula with variable set $\mathcal{X}$ and clause set $\mathcal{C}$ with no negative literals, in which every clause has exactly three literals. The graph $G_F$ is constructed as follows:

\begin{enumerate}
\item For each clause $C_i \in \mathcal{C}$ create a  \textit{clause gadget} $G_{C_i}$, isomorphic to  graph $H$;

\item For each variable $x_{j}\in \mathcal{X}$ create a \emph{variable vertex} $v_{j}$ that is adjacent to the vertex $a$, $e,$ or $h$ of $G_{C_i}$, when $x_{j}$ is the first, second or third variable in $C_i$, respectively;

\item For each variable vertex $v_{j}$, construct a \emph{variable gadget} formed by adding two copies of $H$, $H_1$ and $H_2$, and making $v_j$ adjacent to the vertices of the 2 triangles $(a, b, c)$ in  $H_1$ and $H_2$.

 %where $v_{j}$ is  adjacent to all vertices of the triangle (a,b,c);%; (c,e,g); (g,f,h); or (b,d,f)) of each $H_1$ and $H_2$; 

%\item The  subgraph induced by \emph{variable vertex}  $v_{j}$, and also $V(H_1)$ and $V(H_2)$ will be called \emph{variable gadget}; 

\item Create a vertex $V$, that will be used as vertical reference of the construction, and add an edge from $V$ to each vertex $d$ of a clause gadget;%$d \in V(G_c)$;

\item Create a bipartite graph $K_{2,4}$ with a particular vertex $T$ that is in the largest stable set. This vertex is nominated \emph{true vertex}. Vertex $T$ is adjacent to all $v_{j}$ and also to $V$;

\item Create two  graphs isomorphic to $H$, $G_{B1}$ and $G_{B2}$. The vertex $T$ is connected to each vertex of the triangle (a,b,c) in $G_{B1}$ and $G_{B2}$;


\item Create two graphs isomorphic  to $H$, $G_{B3}$ and $G_{B4}$. The vertex $V$ is connected to each vertex of the triangle (a,b,c) in $G_{B3}$ and $G_{B4}$;

\item The  subgraph induced by the set of vertices $\{V(K_{2,4}) \cup  \{T, V\} \cup V(G_{B1}) \cup V(G_{B2}) \cup V(G_{B3}) \cup V(G_{B4})\}$ will be referred to as the  \emph{base gadget}. 
\end{enumerate}
\end{definition}


Figure~\ref{fig:exemploGrafoGF} illustrates how this construction works on a small formula. %represents the graph that would be obtained when the previous construction is applied to the formula $ F = (x_1 + x_2 + x_3) \wedge (x_2 + x_3 + x_4) \wedge (x_3 + x_1 + x_4)$.

%\vspace{-0.5cm}
%\input{exemploGrafoGF.tex}
\begin{figure}[htb]	
\center%6.3
\includegraphics[width=6.5cm]{exemploGrafoGFSBPO4}
\caption{The $G_{F}$ graph corresponding to formula $F=(x_1+ x_2+ x_3) \wedge  (x_2+ x_3+ x_4 )\wedge  (x_3 + x_1 + x_4 )$}
\label{fig:exemploGrafoGF}
\end{figure}

%\vspace{-0.5cm}

\begin{lemma}\label{lem:ida}
Given a satisfiable instance $F$ of {\sc Positive (1 in 3)-3SAT}, the graph $G_F$ constructed from $F$ according to Definition~\ref{sec:reducao} admits a Helly-$B_1$ EPG representation.
\end{lemma}


% \begin{proof}

% %~\ref{fig:representacaoCaminhos}
% We will use the true pie and false pie structures to represent the \textit{clause gadgets} $ G_C$, but the construction could also be done with the frame structure without loss of generality, see Figure~\ref{fig:falseAndTruePie}.  


% \input{./includes/include-img/falseAndTruePie.tex}

% The \textit{variable gadgets} will be represented by structures as of the Figure~\ref{fig:gadgetVariavel}.

% \input{./includes/include-img/gadgetVariavel.tex}


% The \textit{base gadget} will be represented by the structure of the Figure~\ref{fig:gadgetBaseSingleBend}.

% \input{./includes/include-img/gadgetBase.tex}

% It is easy to see that the representations of the clause gadgets, variable gadgets, and base gadgets are all Helly-$B_1$ EPG. Now we need to describe how these representations can be combined in order to construct a single bend representation $R_{G_F}$.

% Given an assignment $A$ that satisfies $F$, we can construct a  Helly-$B_1$ EPG representation $R_{G_F}$. First we will fix the representation structure of the base gadget in the grid to guide the single bend representation, see Figure~\ref{fig:gadgetBaseSingleBend}. Next we will insert the variable gadgets with the following rule: if the  variable $x_i$ related to the path $P_{v_i}$ had assignment \textit{True}, then the adjacency between the path $P_{v_i}$ with $P_T$ is horizontal, and vertical otherwise. For example, for an assignment $A=\{x_1=False; x_2=False;x_3=True; x_4=False\}$  to variables of the formula $F$ that generated the gadget $G_F$ of the Figure~\ref{fig:exemploGrafoGF}, it will give us a single bend representation (base gadget + variables gadget) according to the Figure~\ref{fig:gadgetBasePlusVariables}(a). 

%  When a formula $F$ of {\sc Positive (1-in-3)-3sat} has clauses whose format of assignment is $(False, True, False)$ or $(False, False, True)$ then we will use false pie to represent these clauses, but when the clause has format $(True, False, False)$ we will use true pie to represent this clause. To insert a \textit{ clause gadget} $G_{C}$, we introduce a horizontal line $l_{h}$ in the grid between the horizontal lines used by the paths for the two false variables in $ C $. Then we connect the path $P_{d_{c_i}}$ of $G_{C_i}$ in $P_V$ vertically using the bend of $P_{d_{c_i}}$. However, we introduce a vertical line $ l_{v}$ in the grid, between the vertical line of the grid used by $P_V$ and the path to the true variable in $C_i$, i.e. between $P_V$ and the path of the true variable $x_j \in C_i$. Where $l_{h}$ and $l_{v}$ cross, insert the center of the  \textit{clause gadget} as can be seen in Figure~\ref{fig:gadgetOnePie}(b). A complete construction of this single bend representation for the $G_F$ can be verified in 
% Figure~\ref{fig:gadgetFormulaCompletaPies}.%~\ref{fig:clausulagadgetgf}. 

% \begin{landscape}
% \input{./includes/include-img/gadgetBasePlusVariables.tex}
% \end{landscape}


% \input{./includes/include-img/gadgetFormulaCompletaPies.tex}


% Note that when we join all these representations of gadgets that form $ R_{G_F} $ we do not insert more bends in paths that had already bend then the representation is necessarily  $ B_1$-EPG. Let us show that it satisfies the Helly property. 

% A simple way to check that $ R_{G_F} $ satisfies the Helly property  is to note that the particular graph $G_F$ never forms triangles between variable, clause, and base gadgets. Thus, any triangle of $G_F$ is inside a variable, clause or base gadget. As we only use Helly-$B_1$ EPG representations of such gadgets, $ R_{G_F} $ is a Helly-$B_1$ EPG representation of $G_F$.
%  \end{proof}

%\cleardoublepage
%\newpage
\begin{proof}
%\textbf{Proof} 
%~\ref{fig:representacaoCaminhos}
We will use the true pie and false pie structures to represent the \textit{clause gadgets} $ G_C$, but the construction could also be done with the frame structure without loss of generality, see Figure~\ref{fig:falseAndTruePie}.  


%\input{falseAndTruePie.tex}
\begin{figure}[htb]
  \centering
%segundo bloco de figuras
  \begin{tabular}{c c c }
    \includegraphics[width=4.5cm]{falsePie}  %\label{fig:falsePie} 
    & &\includegraphics[width=4.5cm]{truePie} %\label{fig:truePie}
    \\%[\abovecaptionskip]
    {\footnotesize (a) Based in false pie}  & &  {\footnotesize(b) Based in true pie}\\
  \end{tabular}
  \caption{Single bend representations of a clause gadget isomorphic to graph $H$
  }\label{fig:falseAndTruePie}
\end{figure} 

The \textit{variable gadgets} will be represented by structures as of Figure~\ref{fig:gadgetVariavel}.

%\input{gadgetVariavel.tex}
\begin{figure}[htb]	
\center%6.3
\includegraphics[width=8cm]{gadgetVariavel2}
%clausulaGadgetGFCompletaSBPO
\caption{Single bend representation of a variable gadget}
\label{fig:gadgetVariavel}
\end{figure}


The \textit{base gadget} will be represented by the structure of Figure~\ref{fig:gadgetBaseSingleBend}.

%\input{gadgetBase.tex}
\begin{figure}[htb]	
\center%6.3
\includegraphics[width=6cm]{gadgetBaseB1Epg}%gf2
%clausulaGadgetGFCompletaSBPO
\caption{Single bend representation of the base gadget}
\label{fig:gadgetBaseSingleBend}
\end{figure}


It is easy to see that the representations of the clause gadgets, variable gadgets, and base gadgets are all Helly-$B_1$ EPG. Now we need to describe how these representations can be combined in order to construct a single bend representation $R_{G_F}$.

Given an assignment $A$ that satisfies $F$, we can construct a  Helly-$B_1$ EPG representation $R_{G_F}$. First we will fix the representation structure of the base gadget in the grid to guide the single bend representation, see Figure~\ref{fig:gadgetBaseSingleBend}. Next we will insert the variable gadgets with the following rule: if the  variable $x_i$ related to the path $P_{v_i}$ had assignment \textit{True}, then the adjacency between the path $P_{v_i}$ with $P_T$ is horizontal, and vertical otherwise. For example, for an assignment $A=\{x_1=False; x_2=False;x_3=True; x_4=False\}$  to variables of the formula $F$ that generated the gadget $G_F$ of Figure~\ref{fig:exemploGrafoGF}, it will give us a single bend representation (base gadget + variables gadget) according to the Figure~\ref{fig:gadgetBasePlusVariables}(a). 

 When a formula $F$ of {\sc Positive (1-in-3)-3sat} has clauses whose format of assignment is $(False,$ $True,$ $False)$ or $(False, False, True)$ then we will use false pie to represent these clauses, but when the clause has format $(True, False, False)$ we will use true pie to represent this clause. To insert a \textit{ clause gadget} $G_{C}$, we introduce a horizontal line $l_{h}$ in the grid between the horizontal rows used by the paths for the two false variables in $ C $. Then we connect the path $P_{d_{c_i}}$ of $G_{C_i}$ to $P_V$ vertically using the bend of $P_{d_{c_i}}$. However, we introduce a vertical line $ l_{v}$ in the grid, between the vertical line of the grid used by $P_V$ and the path to the true variable in $C_i$, \textit{i.e.} between $P_V$ and the path of the true variable $x_j \in C_i$. At the point where $l_{h}$ and $l_{v}$ cross, to insert the center of the  \textit{clause gadget} as can be seen in Figure~\ref{fig:gadgetOnePie}(b). A complete construction of this single bend representation for the $G_F$ can be verified in 
Figure~\ref{fig:gadgetFormulaCompletaPies}.%~\ref{fig:clausulagadgetgf}. 

%imagens estavam aqui

Note that when we join all these representations of gadgets that form $ R_{G_F} $ we do not increase the number of  bends. Then the representation is necessarily  $B_1$-EPG. Let us show that it satisfies the Helly property. 

A simple way to check that $ R_{G_F} $ satisfies the Helly property  is to note that the particular graph $G_F$ never forms triangles between variable, clause, and base gadgets. Thus, any triangle of $G_F$ is inside a variable, clause or base gadget. As we only use Helly-$B_1$ EPG representations of such gadgets, $ R_{G_F} $ is a Helly-$B_1$ EPG representation of $G_F$.
 \end{proof}

Next, we consider the converse. Let $R$ be a Helly-$B_1$ EPG representation  of $G_F$.


%To complete the proof of $NP$-hardness we will  present some considerations related with the single bend representation of gadgets that form the graph $G_F$. The way all gadgets can be drawn makes it possible to recover the formula that generated $G_F$ and a $True-$assignment for it. The following proofs help us understand the construction of a representation to $G_F$.  

%\subsection{Representations for the graph $C_4$}

\begin{definition}
Let $H$ be the graph shown in Figure~\ref{fig:gadgetBase}, such that the 4-cycle $H[\{b, c, f, g \}]$ corresponds in $R$ to a false pie or true pie, then:

\begin{itemize}
\item the \emph{center} is the unique grid-point of this representation which is contained in every path representing 4-cycle $ \{b, c, f, g \}$; \label{lab:lab1}

\item a \emph {central ray} is an edge-intersection  between two of the paths corresponding to vertices  $ b, c, f, g$, respectively.
\end{itemize}
\end{definition}

Note that every $B_1$-EPG representation of a $C_4$ satisfies the Helly property, see Lemma~\ref{lem:representacaoC4}, and triangles have $B_1$-EPG representations that satisfy the Helly property, \textit{e.g.} the one shown in Figure~\ref{fig:trianguloepgRepresentacao}(b). The graph $H$ is composed by a 4-cycle  $C_4^{H}=H[b, c, f, g]$ and eight cycles of size 3.%, which are $(a,b,c);$ $(b,c,bc);$ $(c,e,g);$ $(c,g,cg);$ $(f,g,h);$ $(f,g,fg);$ $(b,d,f);$ $(b,f,bf).$

As $C_4^{H}$ has well known representations (see in Lemma~\ref{lem:representacaoC4}), then we can start drawing the Helly-$B_1$ EPG representation of $H$ from these structures.  Figure~\ref{fig:falsepietruepieframe} shows possible representations for $H$.

%(a), ~\ref{fig:falsepietruepieframe}(b) and ~\ref{fig:falsepietruepieframe}(c) present 3 possible representations of $H$.


If $C_4^{H}$ is represented by a pie, then the paths $P_{b}, P_{c}, P_{f}, P_{g}$ share the center of the representation. On the other hand, if $C_4^{H}$ is represented by a frame then the bends of the 4 paths correspond to the four distinct corners of a rectangle, \textit{i.e.} all paths representing the vertices of $C_4^{H}$ have distinct bend points, see~\cite{golumbic2009}.

%\begin{landscape}
%\input{gadgetBasePlusVariables.tex}
\begin{figure}[H]
  \centering
%segundo bloco de figuras
  \begin{tabular}{p{7cm} p{7cm} }
   \centering \includegraphics[width=7cm, left]{gadgetBasePlusVariables} &   %gf3
  \includegraphics[width=7cm, left]{gadgetBasePlusVariablesOnePie}%formulaCompletaGFonePiePlusLines \\
  \\
  [\abovecaptionskip]
    \footnotesize \centering (a) Representation with omitted clause gadgets &
  \footnotesize(b) Representation with  $G_{C_1}$  associated with the clause $(x_1+x_2+x_3)$ in highlighted \\
  \end{tabular}

 \caption{Single bend representation of the base and variables gadgets associated with the assignment $x_1=False, x_2=False, x_3=True, x_4=False$} \label{fig:gadgetOnePie} \label{fig:gadgetBasePlusVariables}
\end{figure}
%\end{landscape}

%\input{gadgetFormulaCompletaPies.tex}
\begin{figure}[htb]	
\center%6.3
\includegraphics[width=10cm]{formulaFGCompletaPies}
%clausulaGadgetGFCompletaSBPO
\caption{Single bend representation of $G_F$}
\label{fig:gadgetFormulaCompletaPies}
\end{figure}

Next we examine the use of the frame structure.

%Due asymmetric representations, the frame structure needs to be studied in more detail. Next we will show some constraints of this structure. % in which allow us to consider it. %as gadget in the demonstration.

\begin{prop}\label{lem:direcoesdiferentes}
In a $B_1$-EPG representation of a $C_4$ isomorphic to a frame, every path $P_i$ that represents a vertex of the $C_4$ intersects exactly two other paths $P_{i-1}$ and $P_{i+1}$ of the frame, so that one of the intersections is horizontal and the other is vertical. %where one of them is vertical and another is a horizontal intersection.
\end{prop}

% \begin{proof}
% The proof is immediate.
%  \end{proof}

\begin{prop}\label{lem:mesmaretasuporte}
Given a Helly-$B_1$ EPG representation of a graph $G$ that has an induced $C_4$ whose representation is isomorphic to a frame. If there is a vertex $v$ of $G$, outside the $C_4$, that is adjacent to exactly two consecutive vertices of this $C_4$, then the path representing $v$ shares at least one common edge-intersection with the paths representing both of these vertices.% of $v$ into such $C_4$.  
\end{prop}

% \begin{proof}
% By assumption, $G$ has a triangle containing $v$ and two vertices of a $C_4$. Therefore the path representing $v$ shares at least one common edge intersecting with the paths representing these neighbors, otherwise the representation does not satisfy the Helly property.
%  \end{proof}

%\cleardoublepage
\begin{proof}
By assumption, $G$ has a triangle containing $v$ and two vertices of a $C_4$. Therefore the path representing $v$ shares at least one common edge intersecting with the paths representing these neighbors, otherwise the representation does not satisfy the Helly property.
 \end{proof}


By Proposition~\ref{lem:direcoesdiferentes} and Proposition~\ref{lem:mesmaretasuporte} we can conclude that for every vertex $v_i \in V(H)$ such that $v_i \neq V(C_4^{H})$, when we use a frame to represent the $C_4^{H}$, $P_{v_i}$ will have at least one common edge-intersection with the pair of paths representing its neighbors in $H$. 
Figure~\ref{fig:falsepietruepieframe}(c) presents a possible Helly-$B_1$ EPG representation of $H$. 
Note that we can apply rotations and mirroring operations, while maintaining it as a Helly-$B_1$ EPG representation of $H$.
%On this Helly-$B_1$ EPG representation presented we can apply rotation and mirroring operations, because these operations do not change the structure. We can also a change the direction of the bend (see Figure~\ref{fig:falsepietruepieframe}(c) and Figure~\ref{fig:outraRepresentacaoFrame}), but also adjust other paths if needed, so as to not change the intersections between the paths.

\begin{definition}
In a single bend representation of a graph $C_4$ isomorphic to a frame, the paths that represent consecutive vertices in the $C_4$ are called \emph{con\-se\-cu\-ti\-ve paths} and the segment that corresponds to the intersection between two consecutive paths is called \emph{side intersection}.  
\end{definition}

\begin{lemma}\label{lem:2vertical2horizontal}
In any single bend minimal representation of a graph isomorphic to $H$, there are two paths in $\{P_a, P_e, P_{d}, P_{h} \}$ that have horizontal directions and the other two paths have vertical directions.
\end{lemma}

% \begin{proof}
% If the $C_4^{H} = [b,c,f,g]$ is  represented by a true pie or false then each path of $C_4^{H}$ share two central rays with two other paths of $C_4^{H}$, where each central ray corresponds to one pair of consecutive vertices in $C_4^{H}$.

% As the vertices $a, e, d $ and $ h$ are adjacent to pairs of consecutive vertices in $C_4^{H}$ so the paths $P_{a), P_{e}, P_{d}$ and $P_{h}$ have to be positioned in each one of the different central rays,  2 are horizontal  and 2 are vertical.

% If the $C_4^{H}$ is  represented by a frame then each path of the $C_4^{H}$ has a bend positioned in  the corners of the frame. In the frame, the adjacency relationship of pairs of consecutive vertices in the $C_4^{H}$ is represented by the edge-intersection of the paths that constitute the frame. Thus, since a frame has two parts in the vertical direction and two parts in the horizontal direction, then there are two paths in $\{P_{a}, P_{e}, P_{d}, P_{h}\}$ that have horizontal direction and two that have vertical direction.
%  \end{proof}

\begin{proof}
If the $C_4^{H} = [b,c,f,g]$ is  represented by a true pie or false pie, then each path of $C_4^{H}$ shares two central rays with two other paths of $C_4^{H}$, where each central ray corresponds to one pair of consecutive vertices in $C_4^{H}$.

As the vertices $a, e, d $ and $ h$ are adjacent to pairs of consecutive vertices in $C_4^{H}$ so the paths $P_{a}, P_{e}, P_{d}$ and $P_{h}$ have to be positioned in each one of the different central rays,  2 are horizontal  and 2 are vertical.

If the $C_4^{H}$ is  represented by a frame then each path of the $C_4^{H}$ has a bend positioned in  the corners of the frame. In the frame, the adjacency relationship of pairs of consecutive vertices in the $C_4^{H}$ is represented by the edge-intersection of the paths that constitute the frame. Thus, since a frame has two parts in the vertical direction and two parts in the horizontal direction, then there are two paths in $\{P_{a}, P_{e}, P_{d}, P_{h}\}$ that have horizontal direction and two that have vertical direction.

Note that, by minimality of the representation, no additional edge is needed on the different paths.
 \end{proof}



\begin{corollary} \label{coro:paresMesmoSegmento}
In any single bend minimal representation of a graph isomorphic to $H$, the following paths are on the same central ray or side intersection: $P_{a}$ and $P_{bc}$; $P_{e}$ and $P_{cg}$; $P_{h}$ and $P_{fg}$; $P_{d}$ and $P_{bf}$.

% \begin{itemize}
% \item $P_{a}$ and $p(bc)$;
% \item $P_{e}$ and $p(cg)$;
% \item $P_{h}$ and $p(fg)$;
% \item $P_{d}$ and $p(bf)$.
% \end{itemize}
\end{corollary}

%\input{representacoesB1EpgHellyBase.tex}
\begin{figure}[htb]
  \centering
%segundo bloco de figuras
  \begin{tabular}{c c c c c }
    \includegraphics[width=4cm]{falsePie}  %\label{fig:falsePie} 
    & &\includegraphics[width=4cm]{truePie} %\label{fig:truePie}
    & &
 \includegraphics[width=4cm]{frame} \\%[\abovecaptionskip]
    {\footnotesize (a) Based in false pie}  & &  {\footnotesize(b) Based in true pie} & & {\footnotesize (c) Based in frame} %\label{fig:frame}
  \end{tabular}
  \caption{Different single bend representations of the  graph $H$ using a false pie (a), a true pie (b) and a frame (c) for representing  $C_4^{H}$}\label{fig:falsepietruepieframe}
\end{figure} 

%\input{outraRepresentacaoFrame.tex}
\begin{figure}[htb]	
\center%6.3
\includegraphics[width=4cm]{outraRepresentacaoFrame3}
\caption{A frame representation where the bend of dashed paths change directions}
\label{fig:outraRepresentacaoFrame}
\end{figure}

%\vspace{-0.5cm}



\begin{fact} \label{fact:k24facts}
In every single bend representation of a $K_{2,4}$, the path representing each vertex of the larger part has its bend in a false pie (claim in~\cite{daniel2014b} and reasoning in~\cite{Asinowski2009}).
\end{fact} %fac

The following proposition helps us in understanding of the $NP$-hardness proof.

\begin{prop}
In any single bend Helly representation of the graph $G'$ presented in Figure~\ref{fig:extremidadeDobraObstruida}(a), the path $P_{x}$ has obstructed extremities and bends.
\end{prop}

\begin{proof} %\textbf{Proof 4.3}: 
Consider $G'$ consisting of a vertex $x$ together with two graphs, $ H_1 $ and $ H_2 $, isomorphic to $H$ and a bipartite graph $K_{2,4}$, such that: $x$ is a vertex of the largest stable set of the $K_{2,4}$; $x$ is adjacent to an induced cycle of size 3 of $H_1$, $C_3^{H_1}$ and to an induced cycle of size 3 of $H_2$, $ C_3^{H_2}$, see Figure~\ref{fig:extremidadeDobraObstruida}(a).

We know that the paths belonging to the largest stable set of a $K_{2,4}$ always will bend into a false pie, see Fact~\ref{fact:k24facts}. Since $P_{x}$ is part of the largest stable set of the $K_{2,4}$, then $P_{x}$ has an \emph {obstructed bend}, see Figure~\ref{fig:extremidadeDobraObstruida}(b). 

The vertex $x$ is adjacent to $ C_{3}^{H_1}$ and $ C_3^{H_2}$, so that its path $ P_{x} $ intersects the paths representing them.  But in a single bend representations of a graph isomorphic to $H$ there are pairs of paths that always are on some segment of a central ray or a side intersection, see Corollary~\ref{coro:paresMesmoSegmento}, and the representation of $C_{3}^{H_1}$ ( similarly $C_3^{H_2})$ has one these paths. Therefore, there is an edge in the set of paths that represent ${H_1}$ ( similarly in ${H_2}$) that has a intersection of 3 paths representing $ C_{3}^{H_1}$ (and $ C_3^{H_2}$), otherwise the representation would not be Helly. There is another different edge in the same central ray or side intersection that contains three other paths and one of them is not in the set of paths  $C_{3}^{H_1}$ ( similarly $C_3^{H_2})$. Thus in a single bend representation of $G'$, the paths that represent  $C_{3}^{H_1}$ ( similarly $C_3^{H_2})$ must intersect in a bend edge or an extremity edge of $P_{x}$, because $P_{x}$ intersects only one of the paths that are on some central ray or side intersection where  $C_{3}^{H_1}$ ( similarly $C_3^{H_2})$ is. As the bend of $G'$ is already obstructed by structure of $K_{2,4}$, then ${H_1}$ ( similarly in ${H_2}$) must be positioned at an extremity edge of $P_{x}$. This implies that $ P_{x} $ has a condition of \emph{obstructed extremities}, see Figure~\ref{fig:extremidadeDobraObstruida}(b).
%\input{extremidadeDobraObstruida.tex}
\begin{figure}[h]
  \centering
  \begin{tabular}{p{6cm} p{1cm} p{6cm}}
     \includegraphics[width=5cm, center]{grafoDobraExtremidadeObstruida2} &  &\includegraphics[width=5cm, center]{extremidadeDobraObstruida3}  \\%[\abovecaptionskip]
    \footnotesize \centering (a) The graph $G'$& & \footnotesize \centering (b)A $B_1$-EPG representation of $G'$%\\
 %   &&
  \end{tabular}
 \caption{The sample of  obstructed extremities and bend.}\label{fig:extremidadeDobraObstruida}
\end{figure}
 \end{proof}


% \begin{definition}
% Consider a graph $G$ and a vertex $v \in V(G)$. If in a $B_1$-EPG representation of $G$ the two bend edges (or one extremity edge) of the path $P_{v}$ intersects other paths, then we say that $P_{v}$ has an \emph{obstructed bend (or extremity)}. 
% In addition, given a $B_1$-EPG representation of $G$ where $P_{v}$ has an obstructed bend (or extremity), we say that a subset of paths \emph{obstructs} a bend edge (or an extremity edge) of $P_{v}$ if it intersects such an edge. 
% \end{definition}




% \begin{lemma}\label{lem:obstrucao}
% In any single bend representation of the graph $G'$ presented in Figure~\ref{fig:extremidadeDobraObstruida}(a), the path $P_{x}$ has obstructed extremities and bend.
% \end{lemma}

% \begin{proof}
% Consider $G'$ consisting of a vertex $x$, two graphs isomorphic to $H$, $ H_1 $ and $ H_2 $, and a bipartite graph $K_{2,4}$, such that: $x$ is a vertex of the largest stable set of the $K_{2,4}$; $x$ is adjacent to an induced cycle of size 3 of $H_1$, $C_3^{H_1}$ and to an induced cycle of size 3 of $H_2$, $ C_3^{H_2}$, see Figure~\ref{fig:extremidadeDobraObstruida}(a).

% We know that the paths belonging to the largest stable set of a $K_{2,4}$ always will bend into a false pie, see Fact~\ref{fact:k24facts}. Since $P_{x}$ is part of the largest stable set of the $K_{2,4}$, then $P_{x}$ has an \emph {obstructed bend}, see Figure~\ref{fig:extremidadeDobraObstruida}(b). 

% The vertex $x$ is adjacent to $ C_{3}^{H_1}$ and $ C_3^{H_2}$, so that its path $ P_{x} $ intersects the paths representing them.  But in a single bend representations of a graph isomorph to $H$ there are pairs of paths that always are on some segment of a central ray or a side intersection, see Corollary~\ref{coro:paresMesmoSegmento}, and the representation of $C_{3}^{H_1}$ ( similarly $C_3^{H_2})$ has one these paths. Therefore, there is an edge in the set paths that represent ${H_1}$ ( similarly in ${H_2}$) that has a intersection of 3 paths representing $ C_{3}^{H_1}$ (and $ C_3^{H_2}$), otherwise the representation would not be Helly, and there is one other different edge in the some central ray or side intersection that contains three other paths and one of them is not in set paths  $C_{3}^{H_1}$ ( similarly $C_3^{H_2})$. Thus in a single bend representation of $G'$, the paths that represent  $C_{3}^{H_1}$ ( similarly $C_3^{H_2})$ must intersect in a bend edge or an extremity edge of $P_{x}$, because $P_{x}$ intersects only one of set paths that are on some central ray or side intersection where  $C_{3}^{H_1}$ ( similarly $C_3^{H_2})$ is. As the bend of $G'$ is already obstructed by structure of $K_{2,4}$, then ${H_1}$ ( similarly in ${H_2}$) must be positioned at an extremity edge of $P_{x}$. This implies that $ P_{x} $ has a condition of \emph{obstructed extremities}, see Figure~\ref{fig:extremidadeDobraObstruida}(b).
% \input{./includes/include-img/extremidadeDobraObstruida.tex}
%  \end{proof}




\begin{definition}
We say that a segment $s$ is \emph{internally contained} in a path $P_{x}$ if $s$ is contained in $P_{x}$, and it does not intersect a relevant edge of $P_{x}$. 
\end{definition}

% \begin{fac}
% In a single bend representation of a graph, if a path $P_{y}$ has an obstructed bend and obstructed extremities, and some path $P_{x}$ intersects $P_{y}$, but does not intersect paths that obstruct the extremities and the bend edges of $P_{y}$, then the intersection between $P_{x}$ and $P_{y}$ is internally contained into $P_{y}$. 
% \end{fac}


\begin{lemma}\label{lem:volta}
If a graph $G_F$, constructed according to Definition~\ref{sec:reducao}, admits a Helly-$B_1$ EPG representation, then the associated CNF-formula $F$ is a yes-instance of {\sc Positive (1 in 3)-3sat}.
\end{lemma}

% \setcounter{proof}{3}
% \begin{proof}
% Suppose that $G_F$ has a Helly-$B_1$ EPG representation, $R_{G_F}$.  From $R_{G_F}$ we will construct an assignment that satisfies $F$. 

% First, note that in every single bend representation of a $K_{2,4}$, the path of each vertex of the greater stable set, in particular $P_T$ (in $R_{G_F}$), has bends contained in a false pie (see Fact~\ref{fact:k24facts}). 


% The vertex $T$ is adjacent to the vertices of a triangle of $G_{B1}$ and $G_{B2}$. As the $K_{2,4}$ is positioned in the bend of $P_T$, then in $R_{G_F}$ the representation of $G_{B1}$ and $G_{B2}$ are positioned at the extremities of $P_T$, see Lemma~\ref{lem:obstrucao}.   


% Without loss of generality assume that $P_V \cap P_T$ is a horizontal segment in $R_{G_F}$.

% We can note in $R_{G_F}$ that: the number of paths $P_{d}$ with segment internally contained in $P_V$ is the number of clauses in $F$; the intersection between each $P_{a}, P_{e}, P_{h}$ in the gadget clause and each path $P_{v_j}$ indicates the variables composing the clause. Thus, we can assign to each variable $ x_{j}$ the value \textit{True} if the edge intersecting $P_{v_j}$ and $P_T$ is horizontal, and \textit{False} otherwise. 


% In Lemma~\ref{lem:2vertical2horizontal} it was shown that any minimal $B_1$-EPG representation of a clause gadget has two paths in $\{P_{a}, P_{d}, P_{e}, P_{h}\}$ with vertical direction and the other two paths have horizontal direction. Since $P_{d}$ intersects $P_V$, it follows that in a single bend representation of $G_F$ we must connect two of these in order to represent a false assignment, and exactly one will represent a true assignment. Thus, from $R_{G_F}$ we construct an assignment to $F$ such that every clause has exactly one variable with a true value.  
%  \end{proof}
\begin{proof}%\textbf{Proof} 
Suppose that $G_F$ has a Helly-$B_1$ EPG representation, $R_{G_F}$.  From $R_{G_F}$ we will construct an assignment that satisfies $F$. 

First, note that in every single bend representation of a $K_{2,4}$, the path of each vertex of the greater stable set, in particular $P_T$ (in $R_{G_F}$), has bends contained in a false pie (see Remark~\ref{fact:k24facts}).


The vertex $T$ is adjacent to the vertices of a triangle of $G_{B1}$ and $G_{B2}$. As the $K_{2,4}$ is positioned in the bend of $P_T$, then in $R_{G_F}$ the representations of $G_{B1}$ and $G_{B2}$ are positioned at the extremities of $P_T$, see Proposition 4.3. %~\ref{lem:obstrucao}.   


Without loss of generality assume that $P_V \cap P_T$ is a horizontal segment in $R_{G_F}$.

We can note in $R_{G_F}$ that: the number of paths $P_{d}$ with segment internally contained in $P_V$ is the number of clauses in $F$; the intersection between each $P_{a}, P_{e}, P_{h}$ in the gadget clause and each path $P_{v_j}$ indicates the variables composing the clause. Thus, we can assign to each variable $ x_{j}$ the value \textit{True} if the edge intersecting $P_{v_j}$ and $P_T$ is horizontal, and \textit{False} otherwise. 


In Lemma~\ref{lem:2vertical2horizontal} it was shown that any minimal $B_1$-EPG representation of a clause gadget has two paths in $\{P_{a}, P_{d}, P_{e}, P_{h}\}$ with vertical direction and the other two paths have horizontal direction. Since $P_{d}$ intersects $P_V$, it follows that in a single bend representation of $G_F$ we must connect two of these in order to represent a false assignment, and exactly one will represent a true assignment. Thus, from $R_{G_F}$ we construct an assignment to $F$ such that every clause has exactly one variable with a true value.  
 \end{proof}


Note that a $B_1$-EPG representation is Helly if and only if each clique is represented by an edge-clique (and not by a claw-clique). More details on edge-clique and claw-clique can be found in~\cite{golumbic2009}. Thus, an alternative way to check that a representation is Helly is to note that all cliques are represented as edge-cliques. 

\smallskip

Some of the vertices of $G_F$ have highly constrained $B_1$-EPG representations. Vertex $T$ has its bend	and both extremities	obstructed	by its neighbors in	$G_{B1}$, $G_{B2}$ and in the $K_{2,4}$
subgraphs. Vertex $V$ and each variable vertex $v_i$ must have one of its segments internally contained in $T$, and also have its extremities and bends obstructed.  Therefore, vertex $V$ and each
variable vertex have only one segment each that can be used in an EPG
representation to make them adjacent to the clause gadget. The direction of
this segment, being either horizontal	or vertical, can be used to represent
the true or false value	for the	variable.
The clause gadgets, on the other hand, are such that exactly two of its
adjacencies to the variable vertices and to $V$ can be realized with a
horizontal intersection whereas  the other two must be realized with a
vertical intersection. If we consider the direction used by $V$ as a
truth assignment, we get that exactly one of the variables in each clause
will be	true in	any possible representation of $G_F$. Conversely, it is	fairly
straightforward to obtain a $B_1$-EPG representation for $G_F$ given a truth assignment	for
the formula $F$.

\begin{theorem}
{\sc Helly-$B_1$ EPG graph recognition} is $NP$-complete.
\end{theorem}
\begin{proof} %\textbf{Proof}.
By Theorem~\ref{teo:nppertinencia} and Lemmas~\ref{lem:ida} and~\ref{lem:volta}.
 \end{proof}

We say that a $k$-apex graph is a graph that can be made planar by the removal of $k$ vertices. A $d$-degenerate graph is a graph in which every subgraph has a vertex of degree at most $d$. Recall that {\sc Positive (1 in 3)-3SAT} remains $NP$-complete when the incidence graph of the input formula is planar~\cite{mulzer2008minimum}. Thus, the following corollary holds.

\begin{corollary}\label{coro:2apexAnd3degenerate}
{\sc Helly-$B_1$ EPG graph recognition} is $NP$-complete on $2$-apex and $3$-degenerate graphs.
\end{corollary}

\begin{proof} %\textbf{Proof} 
To prove that $G_F$ is 3-degenerate we just apply the $d$-degenerate graphs recognition algorithm,  consisting of repeatedly removing the vertices of minimum degree from the graph. Note that each vertex to be removed at each iteration of the algorithm always has degree at most three, and therefore the graphs $G_F$ constructed according to Definition~\ref{sec:reducao} are $3$-degenerate.

Now, remind that {\sc Positive (1 in 3)-3SAT} remains $NP$-complete when the incidence graph of $F$ is planar, see~\cite{mulzer2008minimum}. Thus, from an instance $F$ of {\sc Planar Positive (1 in 3)-3SAT}, one can build the incidence graph $F$, let us call it $I_F$. The incidence graph is a bipartite graph where one of the partitions is related to the clauses of $F$ and the other partition is related to its variables. Each clause $ C_i $ of $ F $ is represented by a vertex $ v_{c_i} $ and each variable $ x_j $ of the clauses is represented by a vertex $ v_{x_j} $. An edge $ (v_{c_i}, v_{x_j}) $ exists in $ I_F $ if and only if the variable $ x_j $ occurs in the clause $ C_i $.

%\input{grafoIncidencia2apex.tex}
\begin{figure}[h]
  \centering
  \begin{tabular}{p{4cm} p{1cm} p{4cm}}
     \includegraphics[width=3.5cm, center]{bipartido}%grafoIncidencia2apex 
     &  &\includegraphics[width=3cm, center]{planar}%grafoIncidencia2apexPlanarbkp2  
     \\
     
     %[\abovecaptionskip]
     \footnotesize \centering (a) Incidence graph $I_F$,  in a bipartite representation & & \footnotesize \centering (b)Incidence graph $I_F$ in a planar representation%\\
 %   &&
  \end{tabular}
 \caption{Representations of incidence graph of the formula $F=(x_1+x_2+x_3)\wedge(x_1+x_3+x_4)\wedge(x_1+x_2+x_4)$.}
 \label{fig:grafoIncidencia2apex}
 \label{fig:grafoIncidencia2apexPlanar}
\end{figure}

Figure~\ref{fig:grafoIncidencia2apex}(a) depicts an incidence graph $ I_F $. Since the formula $F$ from which $I_F$ was constructed is an instance of {\sc Planar Positive (1in3)-3SAT}, we know that the incidence graph of the formula $F$ is planar~\cite{mulzer2008minimum}.  Figure~\ref{fig:grafoIncidencia2apexPlanar}(b) depicts a planar embedding of the incidence graph $I_F$.
Finally, by using the planar embedding of the incidence graph, we can appropriately replace the vertices representing variables and clauses in  $I_F$ by variables gadgets and clauses gadgets. As each variable gadget, clause gadget and base gadget are planar, then something not planar may have arisen only from the intersection that was made between them. As $I_F$ assures that there is a planar arrangement between the intersections of the variable devices and clause devices, then from $I_F$ one can construct a graph $G_F$ such that the removal of $V$ and $T$ results into a planar graph, see Figura~\ref{fig:grafoIncidenciaCompleto}. Thus $G_F$ is 2-apex.
\end{proof}


%Para elucidar o CorolÃ¡rio~\ref{coro:2apexAnd3degenerate}, que pode nÃ£o ser trivial, sugerimos o seguinte raciocÃ­nio para provar que $G_F$ Ã© 3-degenerado: aplicar o algoritmo de reconhecimento de grafos $d$-degenerados. 

%As an example, a construction presented follow to elucidate the second part of the corollary. Let us take the formula , which is an instance of {\sc Planar Positive (1in3)-3SAT} and we will prove that the specific gadget $ G_F $ generated from this instance is a $2$-apex graph.



%\input{./includes/include-img/grafoIncidencia2apexPlanar.tex}

%Primeiro, monte o grafo de incidÃªncia de $F$, chamemos ele de $I_F$. O grafo de incidÃªncia Ã© um grafo bipartido onde uma das partiÃ§Ãµes estÃ¡ relacionada com as clÃ¡usulas de $F$ e a outra partiÃ§Ã£o estÃ¡ relacionada com as suas variÃ¡veis. Cada clÃ¡usula $C_i$ de $F$ Ã© representada por um vÃ©rtice $v_{c_i}$ e cada variÃ¡vel $x_j$ das clÃ¡usulas Ã© representada por um vÃ©rtice $v_{x_j}$. Uma aresta  $(v_{c_i}, v_{x_j})$ existe em $I_F$ se e somente se a variÃ¡vel $x_j$ ocorre na clÃ¡usula $C_i$. A Figura~\ref{fig:grafoIncidencia2apex} retrata uma construÃ§Ã£o do grafo de incidÃªncia $I_F$.


%\input{grafoIncidenciaCompleto.tex}
\begin{figure}[H]	
\center%6.3
\includegraphics[width=7cm]{2Apex}%grafoIncidenciaCompleto
\caption{Planar graph $G_F$ built from $I_F$, at less than vertices $V$ and $T$ }
\label{fig:grafoIncidenciaCompleto}
\end{figure}


\bibliographystyle{abbrvnat}
% use the following instead if you encounter problems 
%\bibliographystyle{alpha}
\bibliography{sample-dmtcs}
\label{sec:biblio}


% \begin{proof}
% It is easy to see that the graphs constructed according to Definition~\ref{sec:reducao} are $3$-degenerate.
% As {\sc Positive (1 in 3)-3SAT} remains NP-complete when the incidence graph of $F$ is planar~\cite{mulzer2008minimum}, from an instance $F$ of {\sc Planar Positive (1 in 3)-3SAT}, by using a planar embedding of the incidence graph of $F$, one can observe that by removing $V$ and $T$ from $G_F$ we obtain a planar graph. Thus, $G_F$ is 2-apex. 
%  \end{proof}



\newpage

%\section*{Appendix}

% The following are some examples to illustrate definitions that were cited in the text.


% Now, we describe the proofs that have been omitted in the text, as well as some additional comments.


% %\hspace{0.3cm}
% \begin{lemma*} \textbf{Lemma} \ref{lem:todoGrafoEpgHelly}:
%  Every graph is an EPG-Helly graph.
%  \end{lemma*}
%  %\setcounter{proof}{1}
 
%   \begin{proof}  %\textbf{Proof} 
%   \ref{lem:todoGrafoEpgHelly}:
%   Let $G$ be a graph with $n$ vertices $v_1, v_2, \dots, v_n$ and $\mu$ maximal cliques $C_1, C_2, \dots , C_{\mu }$. We construct an EPG-Helly representation of $G$, using a grid $Q$ of size $(\mu \times 2n)$. The rows correspond to the maximal cliques and are numbered $1, 2, \dots , \mu$. Each vertex $v_j$ corresponds to the pair of columns $j, j+n$. Each maximal clique $C_i$ is mapped into an edge $(i,n), (i,n+1)$. Each path $P_j$ contains all edges $(i,n), (i,n+1)$ corresponding to the maximal cliques $C_i$ containing $v_j$.
  
%   Moreover, two distinct paths $P_j,P_k$ intersect at the edges corresponding to the maximal cliques containing $v_j,v_k$.
  
%   Let $v_j \in V(G)$, consider the maximal cliques containing $v_j$ in ascending order of their indices. The path $P_j$ representing $v_j$, start at vertex $(1,j)$ of $Q$ and descends column $j$ until $(i,j)$, where $C_i$ is the first clique containing $v_j$ then $P_j$ bends at vertex $(i,j)$ and proceeds to the right, travessing edge $(i,n), (i,n+1)$ representing $C_i$. Then $P_j$ proceeds further on row $i$ until reaching vertex $(i, j+n)$, where it bends again, descending column $j+n$ until reaching vertex $(l,j), l>i$, where $C_l$ is the next maximal clique containing $v_j$ where it bends again. It proceeds in row $l$, travessing edge $(l,n),(l,n+1)$, and so on, until all edges of $Q$ corresponding to the maximal cliques containing $v_j$ have been travessed by $P_j$.   
  
% It follows that two distinct paths, $P_j$ and $P_q$, intersect exactly at the rows corresponding to the maximal cliques containing both $v_j$ and $v_q$.  
%   \end{proof}
 
%  Figure~\ref{fig:gradeDemonstracao} shows the grid $Q$ and the path $P_2$ corresponding to the vertex $v_2 \in V(G)$, contained in maximal cliques $C_2, C_4$ and $C_5$ of $G$.
 
%   \input{./includes/include-img/grade.tex}
 

% This proof follows directly from the discussion presented in~\cite{heldt2014}.  

% \begin{lemma*}\textbf{Lemma} \ref{lem:octaedronaohelly}:
% The octahedral graph $O_3$ has a unique minimal  $ B_1$-EPG representation.%, without considering isomorphisms.
% \end{lemma*}

% \begin{proof}
% %\textbf{Proof} 
% \ref{lem:octaedronaohelly}:
% The octahedral graph $ O_3 $ has in its constitution induced cycles of size 4 ($ C_4$'s). 
% Take an induced $ C_4 $ subgraph  of the octahedral $ O_3 $. The pairs of non-adjacent vertices of the induced $C_4$ are false twins whose neighborhoods are the remaining vertices of the induced $C_4$. Each of the vertices outside the $C_4$ are adjacent to all vertices of the $C_4$. Thus, if in a $ B_1$-EPG representation of $C_4$, the $ C_4 $ is represented as a frame, no single bend path can simultaneously intersect the 4 paths representing the vertices of the induced $ C_4 $. Therefore, we conclude that the frame structure can not be part of a $ O_3 $ representation.

% With the same reasoning, take a $ B_1$-EPG representation of $C_4$ where the induced $ C_4 $ subgraph is represented as true pie or false pie. When adding the false twin vertices, which are neighbors of all vertices of $ C_4 $ taken from $ O_3 $, both representations converge to the structure represented in Figure~\ref{fig:octaedro}(b). 
%  \end{proof}

%\input{./includes/include-img/octaedro.tex}

% \begin{lemma*}\textbf{Lemma} \ref{lem:verify1}:
% Each path $P_i$ can be determined in polynomial time, from the considered sequence of edge.
% \end{lemma*}

% \begin{proof}%\textbf{Proof} 
% \ref{lem:verify1}: 
% It is easy to verify that~\ref{it:bullet1} is true, consider the sequence of relevant edges of some path $P_i\in \mathcal{P}$. Start from an extremity edge of $P_i$. Let $t$ be the row (column) containing the last considered relevant edge. The next relevant edge $e'$ in the sequence, must be also contained in row (column) $t$. If $e'$ is an extremity edge, the process is finished and the path has been determined. It contains all edges between the considered relevant edges in the sequence. Otherwise, if $e'$ is a bend edge , the next relevant edge is the second bend edge $e''$ of this same bend, which is contained in some column (row) $t'$. The process continues until the second extremity edge of $P_i$ is located.   

% With the above procedure, we can determine in $\mathcal{O}(k\cdot |V(G)|)$ time, whether path $P_i$ contains any given edge of the grid $Q$. Therefore, the sequence of relevant edges of $P_i$ uniquely determines $P_i$.
%  \end{proof}


% \begin{lemma*}
% \textbf{Lemma} \ref{lem:relevantEdges}:
% Let $R$ be a Helly-$B_k$ EPG representation of $G$, and $P_1, P_2 \in \mathcal{P}$ paths of $R$. Then $P_1, P_2$ are intersecting paths if and only if they contain a common relevant edge.
% \end{lemma*}


% \begin{proof}
% %\textbf{Proof} 
% \ref{lem:relevantEdges}: If $P_1, P_2$ contain a common relevant edge there is nothing to prove. Otherwise, assume that $P_1, P_2$ are intersecting and we show they contain a common relevant edge. Without loss of generality, suppose $P_1, P_2$ intersect at row \textit{i} of the grid, in the  $B_k$-EPG representation $R$. The following are the possible cases that may occur:

% \begin{itemize}
% \item \textbf{Case 1:} Neither $P_1$ nor $P_2$ contain bends in row \textit{i}. 

% Then $P_1$ and $ P_2$  are entirely contained in row \textit{i}. Since they intersect, either $P_1, P_2$  overlap, or one of the paths contains the other. In any these situations, they intersect in a common extremity edge, that is a relevant edge.

% \item \textbf{Case 2:} $P_1$ does not contain bends in \textit{i}, but $ P_2$ does.

% If some bend edge of $P_2$ also belongs to $P_1$, then $P_1, P_2$  intersect in  a relevant edge. Otherwise, since $P_1, P_2$  intersect, the only possibility is that the intersection contains an extremity edge of $P_1$ or $ P_2$. Hence the paths intersect in relevant edge.  

% \item \textbf{Case 3:} Both $P_1$,  $P_2$ contain bends in \textit{i}

% Again, if the intersection occurs in some bend edge of $P_1$  or $P_2$, the lemma follows. Otherwise, the same situation as above must occur, that is $P_1, P_2$  must intersect in same extremity edge.
 
% \end{itemize}
% In any of the cases, $P_1$ and $P_2$ intersect in some relevant edge.
%  \end{proof}


% \begin{lemma*}\textbf{Lemma} \ref{lem:ida}:
% Given a satisfiable instance $F$ of {\sc Positive (1 in 3)-3SAT}, the graph $G_F$ constructed from $F$ according to Definition~\ref{sec:reducao} admits a Helly-$B_1$ EPG representation.
% \end{lemma*}


% \begin{proof}
% %\textbf{Proof} 
% \ref{lem:ida}:
% %~\ref{fig:representacaoCaminhos}
% We will use the true pie and false pie structures to represent the \textit{clause gadgets} $ G_C$, but the construction could also be done with the frame structure without loss of generality, see Figure~\ref{fig:falseAndTruePie}.  


% \input{./includes/include-img/falseAndTruePie.tex}

% The \textit{variable gadgets} will be represented by structures as of Figure~\ref{fig:gadgetVariavel}.

% \input{./includes/include-img/gadgetVariavel.tex}


% The \textit{base gadget} will be represented by the structure of Figure~\ref{fig:gadgetBaseSingleBend}.

% \input{./includes/include-img/gadgetBase.tex}

% It is easy to see that the representations of the clause gadgets, variable gadgets, and base gadgets are all Helly-$B_1$ EPG. Now we need to describe how these representations can be combined in order to construct a single bend representation $R_{G_F}$.

% Given an assignment $A$ that satisfies $F$, we can construct a  Helly-$B_1$ EPG representation $R_{G_F}$. First we will fix the representation structure of the base gadget in the grid to guide the single bend representation, see Figure~\ref{fig:gadgetBaseSingleBend}. Next we will insert the variable gadgets with the following rule: if the  variable $x_i$ related to the path $P_{v_i}$ had assignment \textit{True}, then the adjacency between the path $P_{v_i}$ with $P_T$ is horizontal, and vertical otherwise. For example, for an assignment $A=\{x_1=False; x_2=False;x_3=True; x_4=False\}$  to variables of the formula $F$ that generated the gadget $G_F$ of Figure~\ref{fig:exemploGrafoGF}, it will give us a single bend representation (base gadget + variables gadget) according to the Figure~\ref{fig:gadgetBasePlusVariables}(a). 

%  When a formula $F$ of {\sc Positive (1-in-3)-3sat} has clauses whose format of assignment is $(False, True, False)$ or $(False, False, True)$ then we will use false pie to represent these clauses, but when the clause has format $(True, False, False)$ we will use true pie to represent this clause. To insert a \textit{ clause gadget} $G_{C}$, we introduce a horizontal line $l_{h}$ in the grid between the horizontal rows used by the paths for the two false variables in $ C $. Then we connect the path $P_{d_{c_i}}$ of $G_{C_i}$ to $P_V$ vertically using the bend of $P_{d_{c_i}}$. However, we introduce a vertical line $ l_{v}$ in the grid, between the vertical line of the grid used by $P_V$ and the path to the true variable in $C_i$, i.e. between $P_V$ and the path of the true variable $x_j \in C_i$. Where $l_{h}$ and $l_{v}$ cross, to insert the center of the  \textit{clause gadget} as can be seen in Figure~\ref{fig:gadgetOnePie}(b). A complete construction of this single bend representation for the $G_F$ can be verified in 
% Figure~\ref{fig:gadgetFormulaCompletaPies}.%~\ref{fig:clausulagadgetgf}. 

% %\begin{landscape}
% \input{./includes/include-img/gadgetBasePlusVariables.tex}
% %\end{landscape}


% \input{./includes/include-img/gadgetFormulaCompletaPies.tex}


% Note that when we join all these representations of gadgets that form $ R_{G_F} $ we do not insert more bends in paths that had already bend then the representation is necessarily  $ B_1$-EPG. Let us show that it satisfies the Helly property. 

% A simple way to check that $ R_{G_F} $ satisfies the Helly property  is to note that the particular graph $G_F$ never forms triangles between variable, clause, and base gadgets. Thus, any triangle of $G_F$ is inside a variable, clause or base gadget. As we only use Helly-$B_1$ EPG representations of such gadgets, $ R_{G_F} $ is a Helly-$B_1$ EPG representation of $G_F$.
%  \end{proof}

% \begin{lemma*}\textbf{Lemma} \ref{lem:2vertical2horizontal}:
% In any single bend minimal representation of a graph isomorphic to $H$, there are two paths in $\{P_{a}, P_{e}, P_{d}, P_{h} \}$ that have horizontal direction and the other two paths have vertical direction.
% \end{lemma*}

% \begin{proof}%\textbf{Proof} 
% \ref{lem:2vertical2horizontal}:
% If the $C_4^{H} = [b,c,f,g]$ is  represented by a true pie or false then each path of $C_4^{H}$ share two central rays with two other paths of $C_4^{H}$, where each central ray corresponds to one pair of consecutive vertices in $C_4^{H}$.

% As the vertices $a, e, d $ and $ h$ are adjacent to pairs of consecutive vertices in $C_4^{H}$ so the paths $P_{a}, P_{e}, P_{d}$ and $P_{h}$ have to be positioned in each one of the different central rays,  2 are horizontal  and 2 are vertical.

% If the $C_4^{H}$ is  represented by a frame then each path of the $C_4^{H}$ has a bend positioned in  the corners of the frame. In the frame, the adjacency relationship of pairs of consecutive vertices in the $C_4^{H}$ is represented by the edge-intersection of the paths that constitute the frame. Thus, since a frame has two parts in the vertical direction and two parts in the horizontal direction, then there are two paths in $\{P_{a}, P_{e}, P_{d}, P_{h}\}$ that have horizontal direction and two that have vertical direction.

% Note that, by minimality of the representation, no additional edge is needed on the different paths.
%  \end{proof}

% \begin{pro*} \textbf{Proposition} \ref{lem:mesmaretasuporte}:
% Given a Helly-$B_1$ EPG representation of a graph $G$ that has an induced $C_4$ whose representation is isomorphic to a frame, if there is a vertex $v$ of $G$, outside this $C_4$, that is adjacent to exactly two consecutive vertices of this $C_4$, then the path representing $v$ shares at least one common edge-intersection with the paths representing both vertices.% of $v$ into such $C_4$.  
% \end{pro*}

% \begin{proof} %\textbf{Proof} 
% \ref{lem:mesmaretasuporte}:
% By assumption, $G$ has a triangle containing $v$ and two vertices of a $C_4$. Therefore the path representing $v$ shares at least one common edge intersecting with the paths representing these neighbors, otherwise the representation does not satisfy the Helly property.
%  \end{proof}

% The following proposition helps us in understanding of the $NP$-hardness proof.


% \begin{proposition}
% %\textbf{Proposition 4.3}:  
% %\ref{lem:obstrucao}:
% In any single bend Helly representation of the graph $G'$ presented in Figure~\ref{fig:extremidadeDobraObstruida}(a), the path $P_{x}$ has obstructed extremities and bend.
% \end{proposition}

% \begin{proof} %\textbf{Proof 4.3}: 
% Consider $G'$ consisting of a vertex $x$, two graphs isomorphic to $H$, $ H_1 $ and $ H_2 $, and a bipartite graph $K_{2,4}$, such that: $x$ is a vertex of the largest stable set of the $K_{2,4}$; $x$ is adjacent to an induced cycle of size 3 of $H_1$, $C_3^{H_1}$ and to an induced cycle of size 3 of $H_2$, $ C_3^{H_2}$, see Figure~\ref{fig:extremidadeDobraObstruida}(a).

% We know that the paths belonging to the largest stable set of a $K_{2,4}$ always will bend into a false pie, see Fact~\ref{fact:k24facts}. Since $P_{x}$ is part of the largest stable set of the $K_{2,4}$, then $P_{x}$ has an \emph {obstructed bend}, see Figure~\ref{fig:extremidadeDobraObstruida}(b). 

% The vertex $x$ is adjacent to $ C_{3}^{H_1}$ and $ C_3^{H_2}$, so that its path $ P_{x} $ intersects the paths representing them.  But in a single bend representations of a graph isomorphic to $H$ there are pairs of paths that always are on some segment of a central ray or a side intersection, see Corollary~\ref{coro:paresMesmoSegmento}, and the representation of $C_{3}^{H_1}$ ( similarly $C_3^{H_2})$ has one these paths. Therefore, there is an edge in the set paths that represent ${H_1}$ ( similarly in ${H_2}$) that has a intersection of 3 paths representing $ C_{3}^{H_1}$ (and $ C_3^{H_2}$), otherwise the representation would not be Helly, and there is one other different edge in the same central ray or side intersection that contains three other paths and one of them is not in set paths  $C_{3}^{H_1}$ ( similarly $C_3^{H_2})$. Thus in a single bend representation of $G'$, the paths that represent  $C_{3}^{H_1}$ ( similarly $C_3^{H_2})$ must intersect in a bend edge or an extremity edge of $P_{x}$, because $P_{x}$ intersects only one of set paths that are on some central ray or side intersection where  $C_{3}^{H_1}$ ( similarly $C_3^{H_2})$ is. As the bend of $G'$ is already obstructed by structure of $K_{2,4}$, then ${H_1}$ ( similarly in ${H_2}$) must be positioned at an extremity edge of $P_{x}$. This implies that $ P_{x} $ has a condition of \emph{obstructed extremities}, see Figure~\ref{fig:extremidadeDobraObstruida}(b).
% \input{./includes/include-img/extremidadeDobraObstruida.tex}
%  \end{proof}

% \begin{remark} %\textbf{Fact 4.2}:
% In a single bend representation of a graph, if a path $P_{y}$ has an obstructed bend and obstructed extremities, and some path $P_{x}$ intersects $P_{y}$, but does not intersect paths that obstruct the extremities and the bend edges of $P_{y}$, then the intersection between $P_{x}$ and $P_{y}$ is internally contained into $P_{y}$. 
% \end{remark}

% \begin{lemma*}\textbf{Lemma} \ref{lem:volta}:
% If a graph $G_F$, constructed according to Definition~\ref{sec:reducao}, admits a Helly-$B_1$ EPG representation, then the associated CNF-formula $F$ is a yes-instance of {\sc Positive (1 in 3)-3sat}.
% \end{lemma*}

% %\setcounter{proof}{3}
% \begin{proof}%\textbf{Proof} 
% \ref{lem:volta}:
% Suppose that $G_F$ has a Helly-$B_1$ EPG representation, $R_{G_F}$.  From $R_{G_F}$ we will construct an assignment that satisfies $F$. 

% First, note that in every single bend representation of a $K_{2,4}$, the path of each vertex of the greater stable set, in particular $P_T$ (in $R_{G_F}$), has bends contained in a false pie (see Remark~\ref{fact:k24facts}). 


% The vertex $T$ is adjacent to the vertices of a triangle of $G_{B1}$ and $G_{B2}$. As the $K_{2,4}$ is positioned in the bend of $P_T$, then in $R_{G_F}$ the representation of $G_{B1}$ and $G_{B2}$ are positioned at the extremities of $P_T$, see Proposition 4.3. %~\ref{lem:obstrucao}.   


% Without loss of generality assume that $P_V \cap P_T$ is a horizontal segment in $R_{G_F}$.

% We can note in $R_{G_F}$ that: the number of paths $P_{d}$ with segment internally contained in $P_V$ is the number of clauses in $F$; the intersection between each $P_{a}, P_{e}, P_{h}$ in the gadget clause and each path $P_{v_j}$ indicates the variables composing the clause. Thus, we can assign to each variable $ x_{j}$ the value \textit{True} if the edge intersecting $P_{v_j}$ and $P_T$ is horizontal, and \textit{False} otherwise. 


% In Lemma~\ref{lem:2vertical2horizontal} it was shown that any minimal $B_1$-EPG representation of a clause gadget has two paths in $\{P_{a}, P_{d}, P_{e}, P_{h}\}$ with vertical direction and the other two paths have horizontal direction. Since $P_{d}$ intersects $P_V$, it follows that in a single bend representation of $G_F$ we must connect two of these in order to represent a false assignment, and exactly one will represent a true assignment. Thus, from $R_{G_F}$ we construct an assignment to $F$ such that every clause has exactly one variable with a true value.  
%  \end{proof}

% \begin{coro*}\textbf{Corollary} \ref{coro:2apexAnd3degenerate}:
% {\sc Helly-$B_1$ EPG graph recognition} remains $NP$-complete on $2$-apex and $3$-degenerate graphs.
% \end{coro*}

% \begin{proof} %\textbf{Proof} 
% \ref{coro:2apexAnd3degenerate}:
% It is easy to see that the graphs constructed according to Definition~\ref{sec:reducao} are $3$-degenerate.
% As {\sc Positive (1 in 3)-3SAT} remains $NP$-complete when the incidence graph of $F$ is planar~\cite{mulzer2008minimum}, from an instance $F$ of {\sc Planar Positive (1 in 3)-3SAT}, by using a planar embedding of the incidence graph of $F$, one can observe that by removing $V$ and $T$ from $G_F$ we obtain a planar graph. Thus, $G_F$ is 2-apex. 
%  \end{proof}





% \acknowledgements
% \label{sec:ack}
% At the end of the manuscript, right before the bibliography you might
% want to place an acknowledgment. This can be easily done by using the 
% command \verb!\acknowledgements! as you can see here.

\end{document}
